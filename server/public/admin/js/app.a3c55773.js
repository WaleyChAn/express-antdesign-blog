(function(t){function e(e){for(var a,s,o=e[0],l=e[1],c=e[2],u=0,m=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&m.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(m.length)m.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},r={app:0},i=[];function s(t){return o.p+"js/"+({}[t]||t)+"."+{"chunk-2d0d2ec2":"74c4dc45","chunk-2d0d6ad4":"c0a6405d"}[t]+".js"}function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var a=new Promise((function(e,a){n=r[t]=[e,a]}));e.push(n[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=s(t);var c=new Error;i=function(e){l.onerror=l.onload=null,clearTimeout(u);var n=r[t];if(0!==n){if(n){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,n[1](c)}r[t]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:l})}),12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(e)},o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/admin/",o.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var u=0;u<l.length;u++)e(l[u]);var d=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0597":function(t,e,n){"use strict";n.r(e);n("a481"),n("3b2b");tinymce.PluginManager.add("indent2em",(function(t,e){var n="首行缩进",a=tinymce.util.Tools.resolve("tinymce.util.Tools"),r=t.getParam("indent2em_val","2em"),i=function(){var e=t.dom,n=t.selection.getSelectedBlocks(),i="";a.each(n,(function(t){if(""==i&&(i=e.getStyle(t,"text-indent")==r?"remove":"add"),"add"==i)e.setStyle(t,"text-indent",r);else{var n=e.getAttrib(t,"style"),a=new RegExp("text-indent:[\\s]*"+r+";","ig");n=n.replace(a,""),e.setAttrib(t,"style",n)}}))};t.ui.registry.getAll().icons.indent2em||t.ui.registry.addIcon("indent2em",'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M170.666667 563.2v-102.4H887.466667v102.4zM170.666667 836.266667v-102.4H887.466667v102.4zM512 290.133333v-102.4H887.466667v102.4zM238.933333 341.333333V136.533333l204.8 102.4z" fill="#2c2c2c" p-id="5210"></path></svg>');var s=function(t,e){return function(n){return t.selection.selectorChangedWithUnbind(e.join(","),n.setActive).unbind}};return t.ui.registry.addToggleButton("indent2em",{icon:"indent2em",tooltip:n,onAction:function(){i()},onSetup:s(t,['*[style*="text-indent"]','*[data-mce-style*="text-indent"]'])}),t.ui.registry.addMenuItem("indent2em",{text:n,onAction:function(){i()}}),t.addCommand("indent2em",i),{getMetadata:function(){return{name:n,url:"http://tinymce.ax-z.cn/more-plugins/indent2em.php"}}}}))},"0d6c":function(t,e,n){},"0e79":function(t,e,n){},4678:function(t,e,n){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function r(t){var e=i(t);return n(e)}function i(t){if(!n.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}r.keys=function(){return Object.keys(a)},r.resolve=i,t.exports=r,r.id="4678"},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-config-provider",{attrs:{locale:t.zhCN}},[n("div",{staticClass:"app",attrs:{id:"app"}},[n("router-view")],1)])},i=[],s=n("677e"),o=n.n(s),l=n("c1df"),c=n.n(l);n("5c3a");c.a.locale("zh-cn");var u={data:function(){return{zhCN:o.a}}},d=u,m=n("2877"),p=Object(m["a"])(d,r,i,!1,null,null,null),f=p.exports,h=n("8c4f"),g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-layout"},[n("div",{staticClass:"layout-flex row"},[n("div",{staticClass:"layout-flex-s"},[n("badmin-menu")],1),n("div",{staticClass:"layout-flex-l"},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-s"},[n("badmin-header")],1),n("div",{staticClass:"layout-flex-l"},[n("div",{staticClass:"badmin-body"},[n("router-view")],1)])])])])])},b=[],v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-header"},[n("div",{staticClass:"badmin-box clearfix"},[t.currentCrumbs?n("div",{staticClass:"badmin-crumbs left"},[n("div",{staticClass:"crumbs-back",on:{click:t.backward}},[n("a-icon",{attrs:{type:"arrow-left"}}),n("span",[t._v("后退")])],1),n("a-breadcrumb",t._l(t.currentCrumbs,(function(e,a){return n("a-breadcrumb-item",{key:a},[n("router-link",{attrs:{to:{path:e.url}}},[e.icon?n("a-icon",{attrs:{type:e.icon}}):t._e(),n("span",[t._v(t._s(e.title))])],1),e.children?n("a-menu",{staticClass:"badmin-crumbs-menu",attrs:{slot:"overlay"},slot:"overlay"},[t._l(e.children,(function(e){return[e.children?n("sub-menu",{key:e.key,attrs:{"menu-info":e}}):n("a-menu-item",{key:e.url},[n("router-link",{attrs:{to:{path:e.url}}},[e.icon?n("a-icon",{attrs:{type:e.icon}}):t._e(),n("span",[t._v(t._s(e.title))])],1)],1)]}))],2):t._e()],1)})),1)],1):t._e(),t.currentUser?n("div",{staticClass:"header-user right ml-sm"},[n("a-dropdown",{attrs:{placement:"bottomCenter"}},[n("div",{staticClass:"user-info"},[n("a-avatar",{attrs:{src:t.currentUser.avatar,icon:"user",alt:"avatar"}}),n("span",[t._v(t._s(t.currentUser.nickname||t.currentUser.username))]),n("a-icon",{attrs:{type:"down"}})],1),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",{on:{click:function(e){return t.showModal(t.currentUser)}}},[n("a-icon",{attrs:{type:"edit"}}),n("span",[t._v("修改信息")])],1),"admin"===t.currentUser.nickname?n("a-menu-item",{on:{click:function(e){return t.goto("/sites")}}},[n("a-icon",{attrs:{type:"setting"}}),n("span",[t._v("博客设置")])],1):t._e(),n("a-menu-divider"),n("a-menu-item",{on:{click:t.logout}},[n("a-icon",{attrs:{type:"logout"}}),n("span",[t._v("退出登录")])],1)],1)],1)],1):t._e(),n("div",{staticClass:"right ml-sm"},[n("a-button",{attrs:{type:"primary",shape:"round",icon:"form"},on:{click:t.createPost}},[t._v("\n        新增帖子\n      ")])],1),n("div",{staticClass:"right"},[n("a-button",{attrs:{type:"primary",ghost:"",shape:"round",icon:"home"}},[t._v("\n        访问博客\n      ")])],1)]),n("edit-form",{ref:"editForm",model:{value:t.tmpItem,callback:function(e){t.tmpItem=e},expression:"tmpItem"}})],1)},y=[],w=(n("8e6e"),n("ac6a"),n("456d"),n("ade3")),x=function(t,e){var n=e._c;return n("a-sub-menu",{key:e.props.menuInfo.key},[n("span",{attrs:{slot:"title"},slot:"title"},[e.props.menuInfo.icon?n("a-icon",{attrs:{type:e.props.menuInfo.icon}}):e._e(),n("span",[e._v(e._s(e.props.menuInfo.title))])],1),e._l(e.props.menuInfo.children,(function(t){return[e.parent.hasPermission(t)?[t.children?n("sub-menu",{key:t.key,attrs:{"menu-info":t}}):n("a-menu-item",{key:t.key},[n("router-link",{attrs:{to:{path:t.url}}},[t.icon?n("a-icon",{attrs:{type:t.icon}}):e._e(),n("span",[e._v(e._s(t.title))])],1)],1)]:e._e()]}))],2)},_=[],k={props:["menuInfo"]},C=k,j=Object(m["a"])(C,x,_,!0,null,null,null),I=j.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-modal",{staticClass:"badmin-modal",attrs:{title:t.tmpItem._id?"编辑管理员":"新增管理员",visible:t.modalVisible,afterClose:t.handleClose},on:{cancel:t.handleCancel}},[n("a-form-model",{ref:"modalForm",attrs:{model:t.tmpItem,rules:t.modalFormRules}},[n("a-row",{attrs:{gutter:20}},[n("a-col",{attrs:{span:8}},[n("a-form-model-item",{attrs:{label:"头像",prop:"avatar"}},[n("a-upload",{staticClass:"badmin-uploader-avatar",attrs:{name:"file","list-type":"picture-card","show-upload-list":!1,action:t.mixinUploadUrl(),headers:t.mixinAuthHeaders(),"before-upload":t.beforeUpload},on:{change:t.handleChange}},[t.tmpItem.avatar?n("img",{attrs:{src:t.tmpItem.avatar,alt:"avatar"}}):n("div",[n("a-icon",{attrs:{type:t.uploadLoading?"loading":"plus"}})],1)])],1)],1),n("a-col",{attrs:{span:16}},[n("a-form-model-item",{attrs:{label:"名称",prop:"username"}},[n("a-input",{attrs:{placeholder:"请输入名称",disabled:!!t.tmpItem._id},model:{value:t.tmpItem.username,callback:function(e){t.$set(t.tmpItem,"username",e)},expression:"tmpItem.username"}})],1),n("a-form-model-item",{attrs:{label:"昵称",prop:"nickname"}},[n("a-input",{attrs:{placeholder:"请输入昵称"},model:{value:t.tmpItem.nickname,callback:function(e){t.$set(t.tmpItem,"nickname",e)},expression:"tmpItem.nickname"}})],1)],1)],1),!t.tmpItem._id||t.passwordShow?n("a-form-model-item",{attrs:{label:"密码",prop:"password"}},[n("a-input-password",{attrs:{placeholder:"请输入密码"},model:{value:t.tmpItem.password,callback:function(e){t.$set(t.tmpItem,"password",e)},expression:"tmpItem.password"}})],1):t._e(),t.passwordShow?n("a-form-model-item",{attrs:{label:"确认密码",prop:"confirm"}},[n("a-input-password",{attrs:{placeholder:"请确认密码"},model:{value:t.passwordConfirm,callback:function(e){t.passwordConfirm=e},expression:"passwordConfirm"}})],1):t._e()],1),n("template",{slot:"footer"},[t.tmpItem._id?n("a-button",{staticStyle:{float:"left"},on:{click:function(e){t.passwordShow=!0}}},[n("a-icon",{attrs:{type:"edit"}}),t._v("\n      修改密码\n    ")],1):t._e(),n("a-button",{on:{click:t.handleCancel}},[t._v("\n      取消\n    ")]),n("a-button",{attrs:{type:"primary",loading:t.modalLoading},on:{click:t.handleOk}},[t._v("\n      确认\n    ")])],1)],2)},S=[],D=(n("96cf"),n("1da1")),P=n("2f62");function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){Object(w["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var U={name:"BadminAdminUserEdit",components:{},props:{value:{type:Object,default:function(){return{}}}},data:function(){var t=this,e=function(t,e,n){var a=/^[0-9A-Za-z]*$/;a.test(e)?n():n(new Error("请输入英文、数字或者英文数字组合"))},n=function(e,n,a){""===t.passwordConfirm?a(new Error("请重新输入新的密码")):t.passwordConfirm!==t.tmpItem.password?a(new Error("两次输入结果不一致")):a()};return{tmpItem:{},passwordShow:!1,passwordConfirm:"",uploadLoading:!1,modalVisible:!1,modalLoading:!1,modalFormRules:{username:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"不能超出20个字符！",trigger:"blur"},{validator:e,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度应在6-20个字符之间",trigger:"blur"},{validator:e,trigger:"blur"}],confirm:[{validator:n,trigger:"blur"}]}}},watch:{value:{handler:function(t){this.tmpItem=t},deep:!0},tmpItem:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpItem=this.value},computed:L({},Object(P["b"])({currentUser:"getCurrentUser"})),methods:{handleOk:function(){var t=this;t.$refs.modalForm.validate((function(e){if(!e)return!1;t.modalLoading=!0,t.tmpItem._id?t.onEdit(t.tmpItem._id):t.onSave()}))},handleCancel:function(){this.modalVisible=!1},handleClose:function(){this.tmpItem={},this.modalLoading=!1,this.passwordShow=!1,this.$refs.modalForm.clearValidate()},onSave:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.post("rest/admin_users",this.tmpItem);case 2:e=t.sent,this.modalLoading=!1,e&&e.data&&(this.$message.success("新增成功！"),this.fetchData(),this.modalVisible=!1);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onEdit:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.put("rest/admin_users/".concat(e),this.tmpItem);case 2:n=t.sent,this.modalLoading=!1,n&&n.data&&(this.$message.success("修改成功！"),this.currentUser._id===e?this.$router.go(0):this.fetchData(),this.modalVisible=!1);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){this.$emit("fetchData")},handleChange:function(t){if("uploading"===t.file.status)return this.tmpItem.avatar="",void(this.uploadLoading=!0);"done"===t.file.status&&t.file.response&&(this.tmpItem.avatar=t.file.response.url,this.uploadLoading=!1),"error"===t.file.status&&(this.$message.error("图片上传失败"),this.uploadLoading=!1)},beforeUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type;e||this.$message.error("请上传jpg或者png格式的头像");var n=t.size/1024/1024<2;return n||this.$message.error("图片大小请不要超过2MB"),e&&n}}},R=U,V=Object(m["a"])(R,O,S,!1,null,null,null),T=V.exports;function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){Object(w["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var z={name:"BadminHeader",components:{SubMenu:I,EditForm:T},data:function(){return{tmpItem:{}}},computed:A({},Object(P["b"])({currentCrumbs:"getCurrentCrumbs",currentUser:"getCurrentUser"})),methods:{showModal:function(t){t&&(this.tmpItem=JSON.parse(JSON.stringify(t))),this.$refs.editForm.modalVisible=!0},backward:function(){this.$router.back()},createPost:function(){this.$router.push("/posts/edit")},logout:function(){var t=this;t.$confirm({title:"确定退出登录吗?",onOk:function(){t.$storage.remove("token"),t.$router.go(0)},class:"badmin-modal"})},goto:function(t){this.$router.push(t)}}},F=z,N=Object(m["a"])(F,v,y,!1,null,null,null),M=N.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-menu"},[n("div",{staticClass:"menu-wrapper"},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-l scroll-y"},[n("a-menu",{attrs:{"default-selected-keys":t.menuSelected,"default-open-keys":t.defaultOpen,mode:"inline","inline-collapsed":t.collapsed}},[t._l(t.menuList,(function(e){return[t.hasPermission(e)?[e.children?n("sub-menu",{key:e.key,attrs:{"menu-info":e}}):n("a-menu-item",{key:e.key},[n("router-link",{attrs:{to:{path:e.url}}},[e.icon?n("a-icon",{attrs:{type:e.icon}}):t._e(),n("span",[t._v(t._s(e.title))])],1)],1)]:t._e()]}))],2)],1),n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"menu-collapsed",on:{click:t.toggleCollapsed}},[n("a-icon",{attrs:{type:t.collapsed?"menu-unfold":"menu-fold"}})],1)])])])])},H=[],Y=(n("6762"),n("2fdb"),n("2909")),q=[{key:"2",title:"博客管理",icon:"control",children:[{key:"2-1",title:"帖子管理",url:"/posts"},{key:"2-2",title:"分类管理",url:"/categories"},{key:"2-3",title:"广告管理",url:"/ads"}]},{key:"3",title:"系统设置",icon:"setting",roles:["admin"],children:[{key:"3-1",title:"管理员设置",url:"/admin_users"},{key:"3-2",title:"博客设置",url:"/sites"}]}];function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){Object(w["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var X={name:"BadminMenu",components:{SubMenu:I},data:function(){return{collapsed:!1,defaultOpen:["1","2","3"],menuList:q}},computed:W(W({},Object(P["b"])({currentUser:"getCurrentUser",currentCrumbs:"getCurrentCrumbs"})),{},{menuSelected:function(){var t=Object(Y["a"])(this.currentCrumbs),e=t.pop(),n=e?e.key:"";return[n]}}),watch:{$route:function(){this.setCurrentCrumbs()}},created:function(){this.setCurrentCrumbs()},methods:W(W({},Object(P["c"])({updateCurrentCrumbs:"UPDATE_CURRENT_CRUMBS"})),{},{setCurrentCrumbs:function(){var t=this,e=this.menuList,n=this.$route.path,a=this.findPathByLeafUrl(n,e);a.map((function(e){t.hasPermission(e)||t.$router.push("/403")})),this.updateCurrentCrumbs(a)},findPathByLeafUrl:function(t,e,n){void 0===n&&(n=[]);for(var a=0;a<e.length;a++){var r=n.concat();if(r.push(e[a]),-1!==t.indexOf(e[a].url))return r;if(e[a].children){var i=this.findPathByLeafUrl(t,e[a].children,r);if(i)return i}}},toggleCollapsed:function(){this.collapsed=!this.collapsed},hasPermission:function(t){var e=!0,n=this.currentUser.username;return t.roles&&!t.roles.includes(n)&&(e=!1),e}})},G=X,Z=Object(m["a"])(G,B,H,!1,null,null,null),K=Z.exports,Q={name:"BadminLayout",components:{BadminHeader:M,BadminMenu:K},methods:{}},tt=Q,et=Object(m["a"])(tt,g,b,!1,null,null,null),nt=et.exports,at=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-login"},[n("div",{staticClass:"login-content"},[t._m(0),n("div",{staticClass:"login-form"},[n("a-form-model",{ref:"loginForm",attrs:{model:t.form,rules:t.rules}},[n("a-form-model-item",{attrs:{prop:"username"}},[n("a-input",{attrs:{placeholder:"用户名",size:"large"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}},[n("a-icon",{attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),n("a-form-model-item",{attrs:{prop:"password"}},[n("a-input-password",{attrs:{placeholder:"密码",size:"large",autocomplete:"new-password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}},[n("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),n("a-form-model-item",[n("a-button",{attrs:{type:"primary",loading:t.loading,size:"large"},on:{click:t.onSubmit}},[t._v("登 录")])],1)],1)],1)])])},rt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login-title"},[n("dl",[n("dt",[t._v("普普通通登录页")]),n("dd",[t._v("(≧∀≦)ゞ请努力想想你的账号密码")])])])}],it={name:"BadminLogin",components:{},data:function(){var t=function(t,e,n){var a=/^[0-9A-Za-z]*$/;a.test(e)?n():n(new Error("请输入英文、数字或者英文数字组合"))};return{loginParams:this.$route.query,loading:!1,form:{username:"",password:""},rules:{username:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"不能超出20个字符！",trigger:"blur"},{validator:t,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度应在6-20个字符之间",trigger:"blur"},{validator:t,trigger:"blur"}]}}},mounted:function(){},methods:{onSubmit:function(){var t=this;t.$refs.loginForm.validate((function(e){if(!e)return t.$message.error("账号密码再想想？"),!1;t.loading=!0,t.login()}))},login:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.post("login",this.form);case 2:e=t.sent,this.loading=!1,e&&e.data&&(this.$storage.set("token",e.data),this.$message.success("登录成功！"),this.goNext());case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),goNext:function(){var t=this.loginParams.redirect||"/";this.$router.push(t),this.loading=!1}}},st=it,ot=Object(m["a"])(st,at,rt,!1,null,null,null),lt=ot.exports,ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-box cover"},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-s"},[n("table-filter",{ref:"tableFilter",on:{create:t.onEdit,search:t.fetchData}})],1),n("div",{ref:"tableWrapper",staticClass:"layout-flex-l"},[n("div",{staticClass:"badmin-table",class:t.setTableClass()},[n("a-table",{attrs:{columns:t.tableColumns,"data-source":t.tableData,scroll:{x:t.tableScrollX,y:t.tableScrollY},pagination:!1,loading:t.tableLoading,"row-key":"_id"},on:{change:t.onTableChange},scopedSlots:t._u([{key:"author",fn:function(e,a){return[n("div",{staticClass:"badmin-avatar"},[n("a-avatar",{attrs:{src:a.author.avatar,icon:"user",alt:"avatar",size:"small"}}),n("span",{staticClass:"name"},[t._v(t._s(a.author.nickname||a.author.username))])],1)]}},{key:"createdAt",fn:function(e,a){return[n("span",[t._v(t._s(t._f("date")(a.createdAt)))])]}},{key:"updatedAt",fn:function(e,a){return[n("span",[t._v(t._s(t._f("date")(a.updatedAt)))])]}},{key:"categories",fn:function(e,a){return[n("div",{staticClass:"badmin-tags"},[a.categories.length>0?t._l(a.categories,(function(e,a){return n("div",{key:a,staticClass:"tags-item",style:{backgroundColor:e.color}},[t._v("\n                  "+t._s(e.name)+"\n                ")])})):n("div",{staticClass:"tags-item"},[t._v("无分类")])],2)]}},{key:"isPublic",fn:function(e,a){return[n("div",{class:[{"text-primary":a.isPublic},{"opacity-5":!a.isPublic}]},[n("a-icon",{attrs:{type:a.isPublic?"unlock":"lock"}}),t._v("\n              "+t._s(a.isPublic?"公开":"私密")+"\n            ")],1)]}},{key:"state",fn:function(e,a){return[n("a-tag",{staticClass:"ma-no",attrs:{color:1===a.state?"blue":"green"}},[t._v(t._s(1===a.state?"正常":"草稿"))])]}},{key:"operation",fn:function(e,a){return[n("span",{staticClass:"table-btn text-primary",on:{click:function(e){return t.onEdit(a._id)}}},[n("a-icon",{attrs:{type:"edit"}}),t._v("\n              编辑\n            ")],1),t.tableData.length?n("a-popconfirm",{attrs:{title:"确定删除帖子吗？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(){return t.onDelete(a._id)}}},[n("span",{staticClass:"table-btn text-error"},[n("a-icon",{attrs:{type:"delete"}}),t._v("\n                删除\n              ")],1)]):t._e()]}}])})],1)]),n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"badmin-filter mt-sm"},[n("div",{staticClass:"filter-item right"},[n("a-pagination",{attrs:{"show-size-changer":"","page-size-options":t.tablePagination.options,"page-size":t.tablePagination.size,total:t.tablePagination.total},on:{"update:pageSize":function(e){return t.$set(t.tablePagination,"size",e)},"update:page-size":function(e){return t.$set(t.tablePagination,"size",e)},showSizeChange:function(e){return t.fetchData()},change:function(e){return t.fetchData()}},model:{value:t.tablePagination.current,callback:function(e){t.$set(t.tablePagination,"current",e)},expression:"tablePagination.current"}})],1)])])])])},ut=[],dt=(n("55dd"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-filter mb-xs clearfix"},[n("div",{staticClass:"filter-item left mb-xs"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.onCreate()}}},[t._v("新增帖子")])],1),n("div",{staticClass:"filter-item right mb-xs ml-sm"},[n("a-input-search",{attrs:{"allow-clear":"",placeholder:"请输入标题搜索帖子"},on:{search:t.onSearch},model:{value:t.searchVal.keyword,callback:function(e){t.$set(t.searchVal,"keyword",e)},expression:"searchVal.keyword"}})],1),n("div",{staticClass:"filter-item right mb-xs"},[n("div",{staticClass:"filter-btn",on:{click:t.onShow}},[n("a-icon",{attrs:{type:"filter",theme:"filled"}}),n("span",[t._v("高级筛选")])],1)]),n("a-drawer",{staticClass:"badmin-drawer-filter",attrs:{placement:"top",closable:!1,mask:!1,visible:t.drawerVisible,height:t.drawerHeight},on:{close:t.onClose}},[n("div",{staticClass:"badmin-form layout-flex column"},[n("div",{staticClass:"layout-flex-l"},[n("a-form-model",{ref:"drawerForm",attrs:{model:t.searchVal}},[n("a-row",{attrs:{gutter:20}},[n("a-col",{attrs:{span:6}},[n("a-form-model-item",{attrs:{label:"名称"}},[n("a-input",{attrs:{placeholder:"请输入标题"},model:{value:t.searchVal.keyword,callback:function(e){t.$set(t.searchVal,"keyword",e)},expression:"searchVal.keyword"}})],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-model-item",{attrs:{label:"作者"}},[n("a-select",{attrs:{placeholder:"请选择作者"},on:{dropdownVisibleChange:function(e){return t.fetchSearcOption("admin_users")}},model:{value:t.searchVal.author,callback:function(e){t.$set(t.searchVal,"author",e)},expression:"searchVal.author"}},[t.searchLoading.admin_users?n("a-spin",{attrs:{slot:"notFoundContent",size:"small"},slot:"notFoundContent"}):t._e(),t.selectOption.admin_users?[n("a-select-option",{attrs:{value:""}},[t._v("全部")]),t._l(t.selectOption.admin_users,(function(e,a){return n("a-select-option",{key:a,attrs:{value:e._id}},[n("span",[t._v(t._s(e.nickname||e.username)+" ")]),n("span",{staticStyle:{opacity:".5"}},[t._v("("+t._s(e.username)+")")])])}))]:t._e()],2)],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-model-item",{attrs:{label:"状态"}},[n("a-select",{model:{value:t.searchVal.state,callback:function(e){t.$set(t.searchVal,"state",e)},expression:"searchVal.state"}},[n("a-select-option",{attrs:{value:0}},[t._v("全部")]),n("a-select-option",{attrs:{value:1}},[t._v("正常")]),n("a-select-option",{attrs:{value:2}},[t._v("草稿")])],1)],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-model-item",{attrs:{label:"分类"}},[n("a-select",{attrs:{"show-arrow":"",placeholder:"请选择分类",mode:"multiple"},on:{dropdownVisibleChange:function(e){return t.fetchSearcOption("categories")}},model:{value:t.searchVal.categories,callback:function(e){t.$set(t.searchVal,"categories",e)},expression:"searchVal.categories"}},[t.searchLoading.categories?n("a-spin",{attrs:{slot:"notFoundContent",size:"small"},slot:"notFoundContent"}):t._e(),t.selectOption.categories?t._l(t.selectOption.categories,(function(e,a){return n("a-select-option",{key:a,attrs:{value:e._id}},[t._v("\n                      "+t._s(e.name)+"\n                    ")])})):t._e()],2)],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-model-item",{attrs:{label:"创建日期"}},[n("a-range-picker",{model:{value:t.searchVal.createdRange,callback:function(e){t.$set(t.searchVal,"createdRange",e)},expression:"searchVal.createdRange"}})],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-model-item",{attrs:{label:"更新日期"}},[n("a-range-picker",{model:{value:t.searchVal.updatedRange,callback:function(e){t.$set(t.searchVal,"updatedRange",e)},expression:"searchVal.updatedRange"}})],1)],1)],1)],1)],1),n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"drawer-footer text-right"},[n("a-button",{on:{click:t.onClose}},[t._v("\n            取消\n          ")]),n("a-button",{staticClass:"ml-xs",attrs:{type:"primary",ghost:""},on:{click:t.onReset}},[t._v("\n            重置\n          ")]),n("a-button",{staticClass:"ml-xs",attrs:{type:"primary",loading:t.drawerLoading},on:{click:t.onSearch}},[t._v("\n            确认\n          ")])],1)])])])],1)}),mt=[],pt={name:"BadminPostFilter",components:{},data:function(){return{searchVal:{keyword:"",author:"",state:0,categories:[],createdRange:[],updatedRange:[]},searchLast:[],searchDefault:[],searchLoading:{},selectOption:{},listAuthor:[],listCat:[],drawerHeight:234,drawerVisible:!1,drawerLoading:!1}},created:function(){this.setDefault()},methods:{fetchSearcOption:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.selectOption[e]&&0!==this.selectOption[e]){t.next=7;break}return this.$set(this.searchLoading,e,!0),t.next=4,this.$http.get("rest/".concat(e));case 4:n=t.sent,this.searchLoading[e]=!1,n&&n.data&&this.$set(this.selectOption,e,n.data.result);case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onCreate:function(){this.$emit("create")},onSearch:function(){this.$emit("search"),this.drawerVisible=!1},onShow:function(){Object.assign(this.searchLast,this.searchVal),this.drawerVisible=!0},onClose:function(){Object.assign(this.searchVal,this.searchLast),this.drawerVisible=!1},onReset:function(){Object.assign(this.searchVal,this.searchDefault)},setDefault:function(){Object.assign(this.searchDefault,this.searchVal)},setFilters:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var n=t.valid,a=t.filter;n&&e.push(a)})),e},getFilters:function(){var t=this.searchVal,e=t.keyword,n=void 0===e?"":e,a=t.author,r=void 0===a?"":a,i=t.state,s=void 0===i?0:i,o=t.categories,l=void 0===o?[]:o,c=t.createdRange,u=void 0===c?[]:c,d=t.updatedRange,m=void 0===d?[]:d,p=[{valid:n.length>0,filter:{title:{$regex:n,$options:"i"}}},{valid:r.length>0,filter:{author:{$eq:r}}},{valid:0!==s,filter:{state:{$eq:s}}},{valid:l.length>0,filter:{categories:{$all:l}}},{valid:u.length>0,filter:{createdAt:{$gte:u[0],$lte:u[1]}}},{valid:m.length>0,filter:{updatedAt:{$gte:m[0],$lte:m[1]}}}],f=this.setFilters(p),h={};return f.length>0&&(h={$and:f}),h}}},ft=pt,ht=Object(m["a"])(ft,dt,mt,!1,null,null,null),gt=ht.exports,bt=n("5a0c"),vt=n.n(bt),yt=[{title:"标题",dataIndex:"title",key:"title",width:400},{title:"作者",dataIndex:"author",key:"author",scopedSlots:{customRender:"author"}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",sorter:!0,scopedSlots:{customRender:"createdAt"}},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",sorter:!0,scopedSlots:{customRender:"updatedAt"}},{title:"分类",dataIndex:"categories",key:"categories",width:300,scopedSlots:{customRender:"categories"}},{title:"私密",dataIndex:"isPublic",align:"center",key:"isPublic",scopedSlots:{customRender:"isPublic"}},{title:"状态",dataIndex:"state",align:"center",key:"state",scopedSlots:{customRender:"state"}},{title:"操作",key:"operation",width:150,align:"center",fixed:"right",scopedSlots:{customRender:"operation"}}],wt={name:"BadminPostList",components:{TableFilter:gt},filters:{date:function(t){return vt()(t).format("YYYY-MM-DD")}},data:function(){return{tableData:[],tableColumns:yt,tableScrollX:1500,tableScrollY:!0,tableScrollInner:!0,tableLoading:!1,tableFetch:{populate:["author","categories"],select:"-body",sort:{createdAt:-1}},tablePagination:{options:["15","30","50"],current:1,size:15,total:300}}},mounted:function(){this.tableScrollInner&&this.mixinTableHeight(),this.fetchData()},methods:{setTableClass:function(){return[{"scroll-inner":this.tableScrollInner},{"scroll-x":this.tableScrollX},{"scroll-y":this.tableScrollY}]},onEdit:function(t){this.$router.push({path:"/posts/edit",query:{id:t}})},onTableChange:function(t,e,n,a){a.currentDataSource;var r=n.field,i=n.order,s=Object(w["a"])({},r,"ascend"===i?1:-1);this.tableFetch.sort=s,this.fetchData()},onDelete:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.delete("rest/posts/".concat(e));case 2:n=t.sent,n&&n.data&&(this.$message.success("删除成功！"),this.fetchData());case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,n,a,r,i,s,o,l,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.tablePagination,n=e.current,a=e.size,r=this.tableFetch,i=r.populate,s=r.select,o=r.sort,l=this.$refs.tableFilter.getFilters(),c={where:l,populate:i,select:s,sort:o,page:n,limit:a},this.tableLoading=!0,t.next=7,this.$http.get("rest/posts",{params:c});case 7:u=t.sent,u&&u.data&&(this.tableData=u.data.result,this.tablePagination.total=u.data.total),this.tableLoading=!1;case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},xt=wt,_t=Object(m["a"])(xt,ct,ut,!1,null,null,null),kt=_t.exports,Ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-spin",{staticClass:"badmin-loading-page",attrs:{spinning:t.pageLoading,size:"large"}},[n("div",{staticClass:"badmin-box cover hidden"},[2===t.tmpItem.state?n("div",{staticClass:"box-superscript"},[t._v("草 稿")]):t._e(),n("div",{staticClass:"box-scroll-wrapper scroll-y"},[n("div",{staticClass:"badmin-form badmin-form-post"},[t.tmpItem._id?n("div",{staticClass:"badmin-alert layout-flex mb-sm"},[n("div",{staticClass:"layout-flex-l"},[n("div",{staticClass:"alert-wrapper clearfix"},[n("div",{staticClass:"alert-item left"},[n("div",{staticClass:"badmin-avatar"},[n("a-avatar",{attrs:{src:t.tmpItem.author.avatar,icon:"user",alt:"avatar",size:"small"}}),n("span",{staticClass:"name"},[t._v(t._s(t.tmpItem.author.nickname||t.tmpItem.author.username))])],1)]),n("div",{staticClass:"alert-item left"},[t._v("\n                创建时间："+t._s(t._f("date")(t.tmpItem.createdAt))+"\n              ")]),n("div",{staticClass:"alert-item left"},[t._v("\n                最新更新："+t._s(t._f("date")(t.tmpItem.updatedAt))+"\n              ")])])])]):t._e(),n("div",{staticClass:"post-title"},[n("a-textarea",{attrs:{placeholder:"请输入标题（建议40字以内）","max-length":40,suffix:"RMB","auto-size":""},model:{value:t.tmpItem.title,callback:function(e){t.$set(t.tmpItem,"title",e)},expression:"tmpItem.title"}}),n("div",{staticClass:"post-title-limit"},[t._v(t._s(t.tmpItem.title&&t.tmpItem.title.length||0)+" / 40")])],1),n("div",{staticClass:"post-body"},[n("tinymce-editor",{model:{value:t.tmpItem.body,callback:function(e){t.$set(t.tmpItem,"body",e)},expression:"tmpItem.body"}})],1),n("a-form-model",{ref:"editForm",attrs:{model:t.tmpItem}},[n("a-form-model-item",{attrs:{label:"描述"}},[n("a-textarea",{attrs:{placeholder:"帖子描述会在首页，以及其他预览页面作为正文预览展示","auto-size":{minRows:3,maxRows:5}},model:{value:t.tmpItem.desc,callback:function(e){t.$set(t.tmpItem,"desc",e)},expression:"tmpItem.desc"}}),n("div",{staticClass:"form-tips"},[n("a-icon",{staticClass:"mr-xs",attrs:{type:"info-circle"}}),t._v("非必填，若不填写，则默认会截取正文前面的部分内容作为描述\n            ")],1)],1),n("a-form-model-item",{attrs:{label:"分类"}},[n("category-picker",{on:{setDefault:t.setDefaultCat},model:{value:t.tmpItem.categories,callback:function(e){t.$set(t.tmpItem,"categories",e)},expression:"tmpItem.categories"}}),n("div",{staticClass:"form-tips"},[n("a-icon",{staticClass:"mr-xs",attrs:{type:"info-circle"}}),t._v("非必选，若不选择分类，则默认为"+t._s(t.defaultCat.name||"")+"分类\n            ")],1)],1),n("a-form-model-item",{attrs:{label:"封面"}},[n("a-row",[n("a-col",{attrs:{span:12}},[n("a-upload-dragger",{staticClass:"badmin-uploader-cover",attrs:{name:"file","show-upload-list":!1,action:t.mixinUploadUrl(),headers:t.mixinAuthHeaders(),"before-upload":t.beforeUpload},on:{change:t.handleChange}},[t.tmpItem.cover?n("img",{attrs:{src:t.tmpItem.cover,alt:"color"}}):t.uploadLoading?n("div",[n("a-icon",{attrs:{type:"loading"}})],1):n("div",[n("p",{staticClass:"ant-upload-drag-icon"},[n("a-icon",{attrs:{type:"picture"}})],1),n("p",{staticClass:"ant-upload-text"},[t._v("\n                      上传封面\n                    ")]),n("p",{staticClass:"ant-upload-hint"},[t._v("\n                      可拖动图片到此区域进行上传\n                    ")])])])],1)],1)],1),n("a-form-model-item",{attrs:{label:"私密性"}},[n("a-radio-group",{attrs:{"default-value":!0,"button-style":"solid"},model:{value:t.tmpItem.isPublic,callback:function(e){t.$set(t.tmpItem,"isPublic",e)},expression:"tmpItem.isPublic"}},[n("a-radio-button",{attrs:{value:!0}},[n("a-icon",{attrs:{type:"unlock"}}),t._v("\n                公开\n              ")],1),n("a-radio-button",{attrs:{value:!1}},[n("a-icon",{attrs:{type:"lock"}}),t._v("\n                私密\n              ")],1)],1),n("div",{staticClass:"form-tips"},[n("a-icon",{staticClass:"mr-xs",attrs:{type:"info-circle"}}),t._v("选择私密后，在博客内将不会展示，在后台依旧可以查看并管理\n            ")],1)],1)],1),n("div",{staticClass:"post-footer"},[n("a-button",{attrs:{type:"primary",shape:"round",size:"large",disabled:null!==t.submitLoading,loading:1===t.submitLoading},on:{click:function(e){return t.handleSubmit(1)}}},[t._v(t._s(1===t.tmpItem.state&&t.tmpItem._id?"保存修改":"发布帖子"))]),t.tmpItem._id&&2!==t.tmpItem.state?t._e():n("a-button",{attrs:{type:"primary",shape:"round",size:"large",ghost:"",disabled:null!==t.submitLoading,loading:2===t.submitLoading},on:{click:function(e){return t.handleSubmit(2)}}},[t._v("保存草稿")]),n("a-button",{attrs:{type:"primary",shape:"round",size:"large",ghost:"",disabled:null!==t.submitLoading},on:{click:t.handlePreview}},[t._v("预览帖子")]),t.tmpItem._id?n("a-button",{attrs:{type:"danger",shape:"round",size:"large",ghost:"",loading:0===t.submitLoading},on:{click:t.handleDelete}},[t._v("删除帖子")]):t._e()],1)],1)])])])},jt=[],It=(n("a481"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-editor",class:t.setClass()},[n("a-spin",{attrs:{spinning:t.loading}},[n("editor",{attrs:{init:t.init,disabled:t.disabled,placeholder:t.placeholder},model:{value:t.tmpValue,callback:function(e){t.tmpValue=e},expression:"tmpValue"}})],1)],1)}),Ot=[],St=n("e562"),Dt=n.n(St),Pt=n("ca72"),$t=(n("0d68"),n("fc39"),n("64d8"),n("84ec"),n("9434"),n("3154"),n("07d7"),n("3aea"),n("bc54"),n("a892"),n("f6cf"),"/admin/"),Lt={name:"BadminTinymceEditor",components:{Editor:Pt["a"]},props:{value:{type:String,default:""},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1},plugins:{type:[String,Array],default:"code codesample lists image wordcount indent2em fullscreen paste media"},toolbar:{type:[String,Array],default:"code codesample | fullscreen | formatselect | bold italic forecolor backcolor | indent2em | alignleft aligncenter alignright alignjustify | lists image media | removeformat | undo redo | bullist numlist outdent indent"}},data:function(){var t=this;return{tmpValue:"",loading:!0,isFocus:!1,init:{language_url:"".concat($t,"tinymce/langs/zh_CN.js"),language:"zh_CN",skin_url:"".concat($t,"tinymce/skins/ui/custom"),content_css:["".concat($t,"tinymce/skins/content/custom/content.min.css")],height:400,plugins:this.plugins,toolbar:this.toolbar,branding:!1,menubar:!1,resize:!1,paste_data_images:!0,init_instance_callback:function(e){t.loading=!1},images_upload_handler:function(e,n,a){return t.uploadImg(e,n,a)},setup:function(e){e.on("focus blur",(function(e){t.handlerFocus(e)}))}}}},watch:{value:{handler:function(t){this.tmpValue=t},deep:!0},tmpValue:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpValue=this.value},mounted:function(){Dt.a.init({})},methods:{uploadImg:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e,n,a){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=new FormData,r.append("file",e.blob(),e.filename()),t.next=4,this.$http.post("upload",r);case 4:i=t.sent,i&&i.data&&n(i.data.url);case 6:case"end":return t.stop()}}),t,this)})));function e(e,n,a){return t.apply(this,arguments)}return e}(),setClass:function(){return[{focus:this.isFocus}]},clear:function(){this.tmpValue=""},handlerFocus:function(t){switch(t.type){case"focus":this.isFocus=!0;break;case"blur":this.isFocus=!1;break}}}},Ut=Lt,Rt=Object(m["a"])(Ut,It,Ot,!1,null,null,null),Vt=Rt.exports,Tt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-categorypicker"},[n("div",{staticClass:"badmin-tags size-m"},[n("div",{staticClass:"tags-group"},t._l(t.list,(function(e,a){return n("div",{key:a,staticClass:"tags-item",class:{active:-1!==t.tmpValue.indexOf(e._id)},on:{click:function(n){return t.itemClick(e._id)}}},[t._v(t._s(e.name))])})),0)])])},Et=[],At={name:"BadminCategoryPicker",components:{},props:{value:{type:Array,default:function(){return[]}}},data:function(){return{tmpValue:[],list:[],loading:!1}},watch:{value:{handler:function(t){this.tmpValue=t},deep:!0},tmpValue:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpValue=this.value,this.fetchData()},methods:{fetchData:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.$http.get("rest/categories");case 3:e=t.sent,this.loading=!1,e&&e.data&&(this.list=e.data.result,this.$emit("setDefault",this.getDefault()));case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),itemClick:function(t){var e=this.tmpValue.indexOf(t);-1===e?this.tmpValue.push(t):this.tmpValue.splice(e,1)},getDefault:function(){var t=this,e={};return t.list.map((function(n){n.catID===t.$config.defaultCategory&&(e=n)})),e}}},zt=At,Ft=Object(m["a"])(zt,Tt,Et,!1,null,"0ee4b786",null),Nt=Ft.exports;function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Bt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){Object(w["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ht={name:"BadminPostEdit",components:{TinymceEditor:Vt,CategoryPicker:Nt},filters:{date:function(t){return vt()(t).format("YYYY-MM-DD")}},data:function(){return{tmpItem:{},submitLoading:null,uploadLoading:!1,pageLoading:!1,defaultCat:{},fetchOpt:{populate:"author"}}},computed:Bt({postID:function(){return this.$route.query.id||""}},Object(P["b"])({currentUser:"getCurrentUser"})),created:function(){this.fetchItem()},methods:{setDefaultCat:function(t){this.defaultCat=t},handleSubmit:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n,a,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={author:this.currentUser,isPublic:!0,state:1},this.tmpItem=Object.assign(n,this.tmpItem),this.tmpItem.state=e,this.tmpItem.desc||(a=50,r=this.tmpItem.body.replace(/<.*?>/gi,"").replace(/\n/gi,"").replace(/&nbsp;/gi,""),i=r.length>a?"...":"",this.tmpItem.desc=r.slice(0,a)+i),0===this.tmpItem.categories.length&&this.tmpItem.categories.push(this.defaultCat._id),t.next=7,this.handleValidate();case 7:this.submitLoading=e,this.tmpItem._id?this.onEdit(this.tmpItem._id):this.onSave();case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handlePreview:function(){},handleDelete:function(){var t=this;t.$confirm({title:"确定删除帖子吗?",onOk:function(){t.submitLoading=0,t.onDelete(t.tmpItem._id)},class:"badmin-modal"})},handleValidate:function(){var t=this,e=new Promise((function(e,n){t.tmpItem.title?t.tmpItem.body?e():(t.$message.warn("请编写正文内容"),n(new Error("body"))):(t.$message.warn("请输入标题"),n(new Error("title")))}));return e},onSave:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.post("rest/post",this.tmpItem);case 2:e=t.sent,this.submitLoading=null,e&&e.data&&(this.$message.success("新增成功！"),this.goto("/posts"));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onEdit:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.put("rest/post/".concat(e),this.tmpItem);case 2:n=t.sent,this.submitLoading=null,n&&n.data&&(this.$message.success("修改成功！"),this.goto("/posts"));case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onDelete:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.delete("rest/posts/".concat(e));case 2:n=t.sent,n&&n.data&&(this.$message.success("删除成功！"),this.goto("/posts"));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleChange:function(t){if("uploading"===t.file.status)return this.tmpItem.avatar="",void(this.uploadLoading=!0);"done"===t.file.status&&t.file.response&&(this.tmpItem.cover=t.file.response.url,this.uploadLoading=!1),"error"===t.file.status&&(this.$message.error("图片上传失败"),this.uploadLoading=!1)},beforeUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type;e||this.$message.error("请上传jpg或者png格式的头像");var n=t.size/1024/1024<5;return n||this.$message.error("图片大小请不要超过2MB"),e&&n},fetchItem:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.postID){t.next=9;break}return e=this.fetchOpt.populate,n={populate:e},this.pageLoading=!0,t.next=6,this.$http.get("rest/posts/".concat(this.postID),{params:n});case 6:a=t.sent,a&&a.data&&(this.tmpItem=a.data),this.pageLoading=!1;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),goto:function(t){this.$router.push(t)}}},Yt=Ht,qt=Object(m["a"])(Yt,Ct,jt,!1,null,null,null),Jt=qt.exports,Wt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-box cover"},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"badmin-filter margin-bottom clearfix"},[n("div",{staticClass:"filter-item left"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.showModal()}}},[t._v("新增分类")])],1)])]),n("div",{staticClass:"layout-flex-l"},[n("div",{staticClass:"badmin-table",class:t.setTableClass()},[n("a-table",{attrs:{columns:t.tableColumns,"data-source":t.tableData,scroll:{x:t.tableScrollX,y:t.tableScrollY},pagination:!1,loading:t.tableLoading,"row-key":"_id"},scopedSlots:t._u([{key:"color",fn:function(e,a){return[n("div",{staticClass:"badmin-tags "},[n("div",{staticClass:"tags-item",style:{backgroundColor:a.color}},[t._v("\n                "+t._s(a.name)+"\n              ")])])]}},{key:"operation",fn:function(e,a){return[n("span",{staticClass:"table-btn text-primary",on:{click:function(e){return t.showModal(a)}}},[n("a-icon",{attrs:{type:"edit"}}),t._v("\n              编辑\n            ")],1),t.tableData.length?n("a-popconfirm",{attrs:{title:"确定删除 “"+a.name+"” 吗？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(){return t.onDelete(a)}}},[n("span",{staticClass:"table-btn text-error"},[n("a-icon",{attrs:{type:"delete"}}),t._v("\n                删除\n              ")],1)]):t._e()]}}])})],1)])]),n("edit-form",{ref:"editForm",on:{fetchData:t.fetchData},model:{value:t.tmpItem,callback:function(e){t.tmpItem=e},expression:"tmpItem"}})],1)},Xt=[],Gt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-modal",{staticClass:"badmin-modal",attrs:{title:t.tmpItem._id?"编辑分类":"新增分类",visible:t.modalVisible,"confirm-loading":t.modalLoading,afterClose:t.handleClose,"ok-text":"确认","cancel-text":"取消"},on:{ok:t.handleOk,cancel:t.handleCancel}},[n("a-form-model",{ref:"modalForm",attrs:{model:t.tmpItem,rules:t.modalFormRules}},[n("a-form-model-item",{attrs:{label:"名称",prop:"name"}},[n("a-input",{attrs:{placeholder:"请输入名称"},model:{value:t.tmpItem.name,callback:function(e){t.$set(t.tmpItem,"name",e)},expression:"tmpItem.name"}})],1),n("a-form-model-item",{attrs:{label:"样式",prop:"color"}},[n("badmin-color-picker",{model:{value:t.tmpItem.color,callback:function(e){t.$set(t.tmpItem,"color",e)},expression:"tmpItem.color"}})],1)],1)],1)},Zt=[],Kt=(n("c5f6"),n("6b54"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-colorpicker"},[n("div",{staticClass:"badmin-tags"},[t._l(t.presets,(function(e,a){return n("div",{key:a,staticClass:"tags-radio",class:{active:e===t.tmpValue},style:{borderColor:e},on:{click:function(n){t.tmpValue=e}}},[n("div",{staticClass:"tags-item",style:{backgroundColor:e}},[t._v("颜色-"+t._s(a+1))])])})),n("a-popover",{attrs:{trigger:"click"},on:{visibleChange:t.handleVisible}},[n("template",{slot:"content"},[n("chrome-picker",{staticClass:"badmin-colorpicker-palette",on:{input:t.updateValue},model:{value:t.pickerValue,callback:function(e){t.pickerValue=e},expression:"pickerValue"}})],1),n("div",{staticClass:"tags-radio",class:{active:t.tmpValue&&-1===t.presets.indexOf(t.tmpValue)},style:{borderColor:t.tmpValue}},[n("div",{staticClass:"tags-item",style:{backgroundColor:-1===t.presets.indexOf(t.tmpValue)?t.tmpValue:""}},[t._v("自定义")])])],2)],2)])}),Qt=[],te=n("c345"),ee={name:"BadminColorPicker",components:{ChromePicker:te["Chrome"]},props:{value:{type:[String,Object],default:""},presets:{type:Array,default:function(){return["#409eff","#67c23a","#f56c6c","#f8b62b"]}}},data:function(){return{tmpValue:"",pickerValue:{}}},watch:{value:{handler:function(t){this.tmpValue=t||this.presets[0]||"#c0c4cc"},deep:!0},tmpValue:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpValue=this.value||this.presets[0]||"#c0c4cc"},methods:{handleVisible:function(t){t&&(this.pickerValue=JSON.parse(JSON.stringify(this.tmpValue)))},updateValue:function(t){var e=t.rgba||{},n="rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")");this.tmpValue=n}}},ne=ee,ae=Object(m["a"])(ne,Kt,Qt,!1,null,"441097f4",null),re=ae.exports,ie={name:"BadminCategoryEdit",components:{BadminColorPicker:re},props:{value:{type:Object,default:function(){return{}}}},data:function(){return{tmpItem:{},modalVisible:!1,modalLoading:!1,modalFormRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]}}},watch:{value:{handler:function(t){this.tmpItem=t},deep:!0},tmpItem:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpItem=this.value},methods:{handleOk:function(){var t=this;t.$refs.modalForm.validate((function(e){if(!e)return!1;t.modalLoading=!0,t.tmpItem._id?t.onEdit(t.tmpItem._id):t.onSave()}))},handleCancel:function(){this.modalVisible=!1},handleClose:function(){this.tmpItem={},this.modalLoading=!1,this.passwordShow=!1,this.$refs.modalForm.clearValidate()},onSave:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="cat"+Number(new Date).toString(36),this.$set(this.tmpItem,"catID",e),t.next=4,this.$http.post("rest/categories",this.tmpItem);case 4:n=t.sent,this.modalLoading=!1,n&&n.data&&(this.$message.success("新增成功！"),this.fetchData(),this.modalVisible=!1);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onEdit:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.put("rest/categories/".concat(e),this.tmpItem);case 2:n=t.sent,this.modalLoading=!1,n&&n.data&&(this.$message.success("修改成功！"),this.fetchData(),this.modalVisible=!1);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){this.$emit("fetchData")}}},se=ie,oe=Object(m["a"])(se,Gt,Zt,!1,null,null,null),le=oe.exports,ce=[{title:"ID",dataIndex:"catID",key:"catID"},{title:"名称",dataIndex:"name",key:"name"},{title:"样式",dataIndex:"color",key:"color",scopedSlots:{customRender:"color"}},{title:"操作",key:"operation",width:200,align:"center",scopedSlots:{customRender:"operation"}}],ue={name:"BadminCategoryList",components:{EditForm:le},data:function(){return{tmpItem:{},tableData:[],tableColumns:ce,tableScrollX:!1,tableScrollY:!0,tableLoading:!1}},created:function(){this.fetchData()},methods:{setTableClass:function(){return[{"scroll-x":this.tableScrollX},{"scroll-y":this.tableScrollY}]},showModal:function(t){t&&(this.tmpItem=JSON.parse(JSON.stringify(t))),this.$refs.editForm.modalVisible=!0},resetModal:function(){this.modalLoading=!1,this.modalVisible=!1,this.$refs.modalForm.clearValidate()},onDelete:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e._id,a=e.catID,a!==this.$config.defaultCategory){t.next=6;break}this.$message.warn("请不要删除默认分类"),t.next=10;break;case 6:return t.next=8,this.$http.delete("rest/categories/".concat(n));case 8:r=t.sent,r&&r.data&&(this.$message.success("删除成功！"),this.fetchData());case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.tableLoading=!0,t.next=3,this.$http.get("rest/categories");case 3:e=t.sent,this.tableLoading=!1,e&&e.data&&(this.tableData=e.data.result);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},de=ue,me=Object(m["a"])(de,Wt,Xt,!1,null,null,null),pe=me.exports,fe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-box cover"},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"badmin-filter margin-bottom clearfix"},[n("div",{staticClass:"filter-item left"},[n("a-button",{attrs:{type:"primary",icon:t.isLimit?"exclamation-circle":"plus",disabled:t.isLimit},on:{click:function(e){return t.showModal()}}},[t._v(t._s(t.isLimit?"达到广告最大数":"新增广告"))])],1)])]),n("div",{staticClass:"layout-flex-l"},[n("div",{staticClass:"badmin-table",class:t.setTableClass()},[n("a-table",{attrs:{columns:t.tableColumns,"data-source":t.tableData,scroll:{x:t.tableScrollX,y:t.tableScrollY},pagination:!1,loading:t.tableLoading,"row-key":"_id"},scopedSlots:t._u([{key:"type",fn:function(e,a){return[n("a-tag",{staticClass:"ma-no",attrs:{color:1===a.type?"blue":"green"}},[t._v(t._s(1===a.type?"内部链接":"外部链接"))])]}},{key:"content",fn:function(e,a){return[1===a.type&&a.post?n("span",[t._v("\n              "+t._s(a.post.title)+"\n            ")]):2===a.type&&a.site?n("span",[t._v("\n              "+t._s(a.site.title)+"\n            ")]):n("span",{staticClass:"opacity-6"},[t._v("内容未显示")])]}},{key:"operation",fn:function(e,a){return[n("span",{staticClass:"table-btn text-primary",on:{click:function(e){return t.showModal(a)}}},[n("a-icon",{attrs:{type:"edit"}}),t._v("\n              编辑\n            ")],1),t.tableData.length?n("a-popconfirm",{attrs:{title:"确定删除 “"+a.name+"” 吗？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(){return t.onDelete(a._id)}}},[n("span",{staticClass:"table-btn text-error"},[n("a-icon",{attrs:{type:"delete"}}),t._v("\n                删除\n              ")],1)]):t._e()]}}])})],1)])]),n("edit-form",{ref:"editForm",on:{fetchData:t.fetchData},model:{value:t.tmpItem,callback:function(e){t.tmpItem=e},expression:"tmpItem"}})],1)},he=[],ge=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-drawer",{staticClass:"badmin-drawer",attrs:{title:t.tmpItem._id?"编辑广告":"新增广告",placement:"right",width:400,closable:!1,visible:t.modalVisible,"after-visible-change":t.handleVisibleChange},on:{close:t.handleCancel}},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-l scroll-y px-sm pt-sm"},[n("a-form-model",{ref:"modalForm",attrs:{model:t.tmpItem,rules:t.modalFormRules}},[n("a-form-model-item",{attrs:{label:"类型",prop:"type"}},[n("a-select",{model:{value:t.tmpItem.type,callback:function(e){t.$set(t.tmpItem,"type",e)},expression:"tmpItem.type"}},[n("a-select-option",{attrs:{value:1}},[t._v("\n              内部链接\n            ")]),n("a-select-option",{attrs:{value:2}},[t._v("\n              外部链接\n            ")])],1)],1),1===t.tmpItem.type?[n("a-form-model-item",{attrs:{label:"关联帖子",prop:"post"}},[n("post-picker",{model:{value:t.tmpItem.post,callback:function(e){t.$set(t.tmpItem,"post",e)},expression:"tmpItem.post"}})],1)]:2===t.tmpItem.type?[n("a-form-model-item",{attrs:{label:"标题"}},[n("a-input",{attrs:{placeholder:"请输入标题"},model:{value:t.tmpItem.site.title,callback:function(e){t.$set(t.tmpItem.site,"title",e)},expression:"tmpItem.site.title"}})],1),n("a-form-model-item",{attrs:{label:"描述"}},[n("a-textarea",{attrs:{placeholder:"请输入描述","auto-size":{minRows:3,maxRows:5}},model:{value:t.tmpItem.site.desc,callback:function(e){t.$set(t.tmpItem.site,"desc",e)},expression:"tmpItem.site.desc"}})],1),n("a-form-model-item",{attrs:{label:"链接地址"}},[n("a-input",{attrs:{placeholder:"请输入链接地址"},model:{value:t.tmpItem.site.url,callback:function(e){t.$set(t.tmpItem.site,"url",e)},expression:"tmpItem.site.url"}})],1),n("a-form-model-item",{attrs:{label:"封面"}},[n("a-upload-dragger",{staticClass:"badmin-uploader-cover",attrs:{name:"file","show-upload-list":!1,action:t.mixinUploadUrl(),headers:t.mixinAuthHeaders(),"before-upload":t.beforeUpload},on:{change:t.handleChange}},[t.tmpItem.site.cover?n("img",{attrs:{src:t.tmpItem.site.cover,alt:"cover"}}):t.uploadLoading?n("div",[n("a-icon",{attrs:{type:"loading"}})],1):n("div",[n("p",{staticClass:"ant-upload-drag-icon"},[n("a-icon",{attrs:{type:"picture"}})],1),n("p",{staticClass:"ant-upload-text"},[t._v("\n                  上传封面\n                ")]),n("p",{staticClass:"ant-upload-hint"},[t._v("\n                  可拖动图片到此区域进行上传\n                ")])])])],1)]:n("a-empty",{attrs:{description:"请选择类型"}})],2)],1),n("div",{staticClass:"layout-flex-s text-right pa-sm"},[n("a-button",{on:{click:t.handleCancel}},[t._v("\n        取消\n      ")]),n("a-button",{staticClass:"ml-xs",attrs:{type:"primary",loading:t.modalLoading},on:{click:t.handleOk}},[t._v("\n        确认\n      ")])],1)])])},be=[],ve=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-postpicker"},[n("a-input",{ref:"postpickerInput",attrs:{placeholder:"请选择帖子"},on:{click:t.onShow},model:{value:t.tmpValue,callback:function(e){t.tmpValue=e},expression:"tmpValue"}},[n("a-icon",{attrs:{slot:"suffix",type:"search"},slot:"suffix"})],1),t.tmpPost?n("div",{staticClass:"badmin-list border"},[n("div",{staticClass:"list-item"},[n("div",{staticClass:"close-btn",on:{click:t.handlerClear}},[n("a-icon",{attrs:{type:"close"}})],1),n("div",{staticClass:"title"},[t._v(" "+t._s(t.tmpPost.title))]),n("div",{staticClass:"info clearfix"},[n("div",{staticClass:"info-item"},[n("a-icon",{attrs:{type:"user"}}),n("span",[t._v("\n            "+t._s(t.tmpPost.author.nickname||t.tmpPost.author.username)+"\n          ")])],1),n("div",{staticClass:"info-item"},[n("a-icon",{attrs:{type:"clock-circle"}}),n("span",[t._v("\n            "+t._s(t._f("date")(t.tmpPost.createdAt))+"\n          ")])],1),t.tmpPost.categories.length>0?n("div",{staticClass:"info-item"},[n("a-icon",{attrs:{type:"tags"}}),t._l(t.tmpPost.categories,(function(e,a){return n("span",{key:a},[t._v("\n            "+t._s(e.name)+"\n          ")])}))],2):t._e()])])]):t._e(),n("a-modal",{staticClass:"badmin-modal list-wrapper",attrs:{visible:t.modalVisible,"confirm-loading":t.modalLoading,afterClose:t.handleClose,closable:!1,"ok-text":"确认","cancel-text":"取消"},on:{ok:t.handleOk,cancel:t.handleCancel}},[n("div",{staticClass:"layout-flex column pa-sm"},[n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"badmin-filter mb-sm clearfix"},[n("div",{staticClass:"filter-item",staticStyle:{width:"100%"}},[n("a-input-search",{attrs:{"allow-clear":"",placeholder:"请输入标题搜索帖子"},on:{search:t.fetchData},model:{value:t.tableSearch.keyword,callback:function(e){t.$set(t.tableSearch,"keyword",e)},expression:"tableSearch.keyword"}})],1)])]),n("div",{ref:"tableWrapper",staticClass:"layout-flex-l scroll-y"},[n("div",{staticClass:"badmin-list selectable"},t._l(t.tableData,(function(e,a){return n("div",{key:a,staticClass:"list-item",class:{active:t.pickerVal._id?e._id===t.pickerVal._id:e._id===t.tmpValue},on:{click:function(n){t.pickerVal=e}}},[n("div",{staticClass:"title"},[t._v(t._s(e.title))]),n("div",{staticClass:"info clearfix"},[n("div",{staticClass:"info-item"},[n("a-icon",{attrs:{type:"user"}}),n("span",[t._v("\n                  "+t._s(e.author.nickname||e.author.username)+"\n                ")])],1),n("div",{staticClass:"info-item"},[n("a-icon",{attrs:{type:"clock-circle"}}),n("span",[t._v("\n                  "+t._s(t._f("date")(e.createdAt))+"\n                ")])],1),e.categories.length>0?n("div",{staticClass:"info-item"},[n("a-icon",{attrs:{type:"tags"}}),t._l(e.categories,(function(e,a){return n("span",{key:a},[t._v("\n                  "+t._s(e.name)+"\n                ")])}))],2):t._e()])])})),0)])]),n("template",{slot:"footer"},[n("div",{staticStyle:{float:"left",padding:"4px 0"}},[n("a-pagination",{attrs:{simple:"","show-size-changer":"","page-size-options":t.tablePagination.options,"page-size":t.tablePagination.size,total:t.tablePagination.total},on:{"update:pageSize":function(e){return t.$set(t.tablePagination,"size",e)},"update:page-size":function(e){return t.$set(t.tablePagination,"size",e)},showSizeChange:function(e){return t.fetchData()},change:function(e){return t.fetchData()}},model:{value:t.tablePagination.current,callback:function(e){t.$set(t.tablePagination,"current",e)},expression:"tablePagination.current"}})],1),n("a-button",{on:{click:t.handleCancel}},[t._v("\n        取消\n      ")]),n("a-button",{attrs:{type:"primary",loading:t.modalLoading},on:{click:t.handleOk}},[t._v("\n        确认\n      ")])],1)],2)],1)},ye=[],we={name:"BadminPostPicker",components:{},props:{value:{type:String,default:""}},filters:{date:function(t){return vt()(t).format("YYYY-MM-DD")}},data:function(){return{tmpValue:"",tmpPost:null,modalVisible:!1,modalLoading:!1,modalTimer:null,tableData:[],tableFetch:{populate:["author","categories"],select:"-body -isPublic -state",sort:{createdAt:-1}},tablePagination:{options:["15","30","50"],current:1,size:15,total:300},tableSearch:{keyword:"",state:1,isPublic:!0},pickerVal:{value:"",post:{}}}},watch:{value:{handler:function(t){this.tmpValue=t},deep:!0},tmpValue:{handler:function(t){this.$emit("input",t)},deep:!0}},mounted:function(){this.tmpValue=this.value,this.tmpValue.length>0&&!this.tmpPost&&this.fetchItem(this.tmpValue)},methods:{onShow:function(){this.modalVisible=!0,0===this.tableData.length&&this.fetchData()},handleClose:function(){this.$refs.postpickerInput.blur(),this.pickerVal={}},handleOk:function(){this.tmpValue=this.pickerVal._id,this.tmpPost=this.pickerVal,this.pickerVal={},this.modalVisible=!1},handleCancel:function(){this.modalVisible=!1},handlerClear:function(){this.tmpValue="",this.tmpPost=null,this.pickerVal={}},fetchItem:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n,a,r,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.tableFetch,a=n.populate,r=n.select,i={populate:a,select:r},t.next=4,this.$http.get("rest/posts/".concat(e),{params:i});case 4:s=t.sent,s&&s.data&&(this.tmpPost=s.data);case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,n,a,r,i,s,o,l,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.tablePagination,n=e.current,a=e.size,r=this.tableFetch,i=r.populate,s=r.select,o=r.sort,l={$and:[{title:{$regex:this.tableSearch.keyword,$options:"i"}},{isPublic:{$eq:this.tableSearch.isPublic}},{state:{$eq:this.tableSearch.state}}]},c={where:l,populate:i,select:s,sort:o,page:n,limit:a},t.next=6,this.$http.get("rest/posts",{params:c});case 6:u=t.sent,u&&u.data&&(this.tableData=u.data.result,this.tablePagination.total=u.data.total);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},xe=we,_e=Object(m["a"])(xe,ve,ye,!1,null,"b1b24abc",null),ke=_e.exports,Ce={name:"BadminAdEdit",components:{PostPicker:ke},props:{value:{type:Object,default:function(){return{}}}},data:function(){return{tmpItem:{},modalVisible:!1,modalLoading:!1,modalFormRules:{type:[{required:!0,message:"请选择类型",trigger:"change"}]},uploadLoading:!1}},watch:{value:{handler:function(t){this.tmpItem=t},deep:!0},tmpItem:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpItem=this.value},methods:{handleOk:function(){var t=this;t.$refs.modalForm.validate((function(e){if(1!==t.tmpItem.type||t.tmpItem.post)if(2!==t.tmpItem.type||t.tmpItem.site.title){if(!e)return!1;t.modalLoading=!0,t.tmpItem._id?t.onEdit(t.tmpItem._id):t.onSave()}else t.$message.error("请输入标题");else t.$message.error("请选择帖子")}))},handleCancel:function(){this.modalVisible=!1},handleVisibleChange:function(){this.modalVisible||(this.tmpItem={},this.modalLoading=!1,this.passwordShow=!1,this.$refs.modalForm.clearValidate())},handleChange:function(t){if("uploading"===t.file.status)return this.tmpItem.avatar="",void(this.uploadLoading=!0);"done"===t.file.status&&t.file.response&&(this.tmpItem.site.cover=t.file.response.url,this.uploadLoading=!1),"error"===t.file.status&&(this.$message.error("图片上传失败"),this.uploadLoading=!1)},beforeUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type;e||this.$message.error("请上传jpg或者png格式的头像");var n=t.size/1024/1024<5;return n||this.$message.error("图片大小请不要超过2MB"),e&&n},onSave:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="ad"+this.tmpItem.type+Number(new Date).toString(36),this.$set(this.tmpItem,"adID",e),t.next=4,this.$http.post("rest/ads",this.tmpItem);case 4:n=t.sent,this.modalLoading=!1,n&&n.data&&(this.$message.success("新增成功！"),this.fetchData(),this.modalVisible=!1);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onEdit:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.put("rest/ads/".concat(e),this.tmpItem);case 2:n=t.sent,this.modalLoading=!1,n&&n.data&&(this.$message.success("修改成功！"),this.fetchData(),this.modalVisible=!1);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){this.$emit("fetchData")}}},je=Ce,Ie=Object(m["a"])(je,ge,be,!1,null,null,null),Oe=Ie.exports,Se=[{title:"广告ID",dataIndex:"adID",key:"adID"},{title:"内容",dataIndex:"content",key:"content",scopedSlots:{customRender:"content"}},{title:"类型",dataIndex:"type",key:"type",align:"center",scopedSlots:{customRender:"type"}},{title:"操作",key:"operation",width:200,align:"center",scopedSlots:{customRender:"operation"}}],De={name:"BadminAdList",components:{EditForm:Oe},data:function(){return{tmpItem:{},tableData:[],tableColumns:Se,tableScrollX:!1,tableScrollY:!0,tableLoading:!1,tableFetch:{populate:[{path:"post",select:"title"}]}}},created:function(){this.fetchData()},computed:{isLimit:function(){return 5===this.tableData.length}},methods:{setTableClass:function(){return[{"scroll-x":this.tableScrollX},{"scroll-y":this.tableScrollY}]},showModal:function(t){t&&(this.tmpItem=JSON.parse(JSON.stringify(t)),this.tmpItem.post&&this.tmpItem.post._id&&(this.tmpItem.post=this.tmpItem.post._id));var e={site:{}};this.tmpItem=Object.assign(e,this.tmpItem),this.$refs.editForm.modalVisible=!0},resetModal:function(){this.modalLoading=!1,this.modalVisible=!1,this.$refs.modalForm.clearValidate()},onDelete:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.delete("rest/ads/".concat(e));case 2:n=t.sent,n&&n.data&&(this.$message.success("删除成功！"),this.fetchData());case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.tableFetch.populate,n={populate:e},this.tableLoading=!0,t.next=5,this.$http.get("rest/ads",{params:n});case 5:a=t.sent,this.tableLoading=!1,a&&a.data&&(this.tableData=a.data.result);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},Pe=De,$e=Object(m["a"])(Pe,fe,he,!1,null,null,null),Le=$e.exports,Ue=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-box cover"},[n("div",{staticClass:"layout-flex column"},[n("div",{staticClass:"layout-flex-s"},[n("div",{staticClass:"badmin-filter margin-bottom clearfix"},[n("div",{staticClass:"filter-item left"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.showModal()}}},[t._v("新增管理员")])],1)])]),n("div",{staticClass:"layout-flex-l"},[n("div",{staticClass:"badmin-table",class:t.setTableClass()},[n("a-table",{attrs:{columns:t.tableColumns,"data-source":t.tableData,scroll:{x:t.tableScrollX,y:t.tableScrollY},pagination:!1,loading:t.tableLoading,"row-key":"_id"},scopedSlots:t._u([{key:"avatar",fn:function(t,e){return[n("a-avatar",{attrs:{src:e.avatar,icon:"user",alt:"avatar"}})]}},{key:"operation",fn:function(e,a){return[n("span",{staticClass:"table-btn text-primary",on:{click:function(e){return t.showModal(a)}}},[n("a-icon",{attrs:{type:"edit"}}),t._v("\n              编辑\n            ")],1),t.tableData.length?n("a-popconfirm",{attrs:{title:"确定删除 “"+a.username+"” 吗？","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(){return t.onDelete(a)}}},[n("span",{staticClass:"table-btn text-error"},[n("a-icon",{attrs:{type:"delete"}}),t._v("\n                删除\n              ")],1)]):t._e()]}}])})],1)])]),n("edit-form",{ref:"editForm",on:{fetchData:t.fetchData},model:{value:t.tmpItem,callback:function(e){t.tmpItem=e},expression:"tmpItem"}})],1)},Re=[],Ve=[{title:"头像",dataIndex:"avatar",key:"avatar",scopedSlots:{customRender:"avatar"}},{title:"名称",dataIndex:"username",key:"username"},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"操作",key:"operation",width:200,align:"center",scopedSlots:{customRender:"operation"}}],Te={name:"BadminAdminUserList",components:{EditForm:T},data:function(){return{tmpItem:{},tableData:[],tableColumns:Ve,tableScrollX:!1,tableScrollY:!0,tableLoading:!1}},created:function(){this.fetchData()},methods:{setTableClass:function(){return[{"scroll-x":this.tableScrollX},{"scroll-y":this.tableScrollY}]},showModal:function(t){t&&(this.tmpItem=JSON.parse(JSON.stringify(t))),this.$refs.editForm.modalVisible=!0},onDelete:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e._id,a=e.username,a!==this.$config.defaultAdmin){t.next=6;break}this.$message.warn("请不要删除默认管理员账号"),t.next=10;break;case 6:return t.next=8,this.$http.delete("rest/admin_users/".concat(n));case 8:r=t.sent,r&&r.data&&(this.$message.success("删除成功！"),this.fetchData());case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetchData:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.tableLoading=!0,t.next=3,this.$http.get("rest/admin_users");case 3:e=t.sent,this.tableLoading=!1,e&&e.data&&(this.tableData=e.data.result);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},Ee=Te,Ae=Object(m["a"])(Ee,Ue,Re,!1,null,null,null),ze=Ae.exports,Fe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-box cover hidden"},[n("div",{staticClass:"box-scroll-wrapper scroll-y"},[n("div",{staticClass:"badmin-form badmin-form-post"},[n("a-form-model",{ref:"siteForm",attrs:{"label-col":{span:3},"wrapper-col":{span:19},model:t.siteForm}},[n("a-form-model-item",{attrs:{label:"网站标题"}},[n("a-input",{attrs:{placeholder:"请输入网页的标题"},model:{value:t.siteForm.title,callback:function(e){t.$set(t.siteForm,"title",e)},expression:"siteForm.title"}})],1),n("a-form-model-item",{attrs:{label:"标签页小图标"}},[n("uploader-image",{attrs:{formats:["image/x-icon"]},model:{value:t.siteForm.ico,callback:function(e){t.$set(t.siteForm,"ico",e)},expression:"siteForm.ico"}}),n("div",{staticClass:"form-tips mt-incell"},[n("a-icon",{staticClass:"mr-xs",attrs:{type:"info-circle"}}),t._v("建议上传尺寸为 "),n("span",{staticClass:"text-primary"},[t._v("16 × 16 (1:1)格式为 ico")]),t._v(" 的图片\n          ")],1)],1),n("a-form-model-item",{attrs:{label:"LOGO"}},[n("uploader-image",{attrs:{formats:["image/jpeg","image/png"]},model:{value:t.siteForm.logo,callback:function(e){t.$set(t.siteForm,"logo",e)},expression:"siteForm.logo"}}),n("div",{staticClass:"form-tips mt-incell"},[n("a-icon",{staticClass:"mr-xs",attrs:{type:"info-circle"}}),t._v("建议上传尺寸为 "),n("span",{staticClass:"text-primary"},[t._v("50 × 50 (1:1)格式为 jpg 或者 png")]),t._v(" 的图片\n          ")],1)],1),n("a-form-model-item",{attrs:{label:"主题色"}},[n("color-picker",{attrs:{presets:t.colorPickerPresets},model:{value:t.siteForm.color,callback:function(e){t.$set(t.siteForm,"color",e)},expression:"siteForm.color"}})],1)],1),n("div",{staticClass:"post-footer"},[n("a-button",{attrs:{type:"primary",shape:"round",size:"large",loading:t.confirmLoading},on:{click:t.handleSubmit}},[t._v("保存修改")])],1)],1)])])},Ne=[],Me=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"badmin-uploader-image"},[n("a-upload",{attrs:{name:"file","list-type":"picture-card","show-upload-list":!1,action:t.mixinUploadUrl(),headers:t.mixinAuthHeaders(),"before-upload":t.beforeUpload},on:{change:t.handleChange}},[t.tmpValue?n("img",{attrs:{src:t.tmpValue,alt:"avatar"}}):n("div",[n("a-icon",{attrs:{type:t.uploadLoading?"loading":"plus"}})],1)])],1)},Be=[],He={name:"BadminUploaderImage",components:{},props:{value:{type:[String,Object],default:""},formats:{type:Array,default:function(){return[]}},limit:{type:Number,default:2}},data:function(){return{tmpValue:"",uploadLoading:!1}},watch:{value:{handler:function(t){this.tmpValue=t},deep:!0},tmpValue:{handler:function(t){this.$emit("input",t)},deep:!0}},created:function(){this.tmpValue=this.value},methods:{handleChange:function(t){if("uploading"===t.file.status)return this.tmpValue="",void(this.uploadLoading=!0);"done"===t.file.status&&t.file.response&&(this.tmpValue=t.file.response.url,this.uploadLoading=!1),"error"===t.file.status&&(this.$message.error("图片上传失败"),this.uploadLoading=!1)},beforeUpload:function(t){console.log(t.type,t.size);var e=!0;this.formats.length>0&&(e=this.formats.includes(t.type)),e||this.$message.error("请上传正确格式的图片");var n=!0;return this.limit>0&&(n=t.size/1024/1024<this.limit),n||this.$message.error("图片大小请不要超过".concat(this.limit,"MB")),e&&n}}},Ye=He,qe=Object(m["a"])(Ye,Me,Be,!1,null,"243d13ce",null),Je=qe.exports;function We(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Xe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?We(Object(n),!0).forEach((function(e){Object(w["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ge={name:"BadminSite",components:{UploaderImage:Je,ColorPicker:re},data:function(){return{siteForm:{},colorPickerPresets:["#f8b62b","#409eff","#67c23a"],confirmLoading:!1}},computed:Xe({},Object(P["b"])({currentUser:"getCurrentUser"})),created:function(){this.setDefault()},methods:Xe(Xe({},Object(P["c"])({updateCurrentUser:"UPDATE_CURRENT_USER"})),{},{setDefault:function(){var t=this.currentUser.site,e=void 0===t?{}:t;this.siteForm=Xe({},e)},handleSubmit:function(){var t=this;this.confirmLoading=!0;var e=Xe({},this.currentUser);e.site||this.$set(e,"site",{}),e.site=Xe({},this.siteForm),this.updateCurrentUser(e),this.$nextTick((function(){t.onSave(t.currentUser._id)}))},onSave:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.put("rest/admin_users/".concat(e),this.currentUser);case 2:n=t.sent,this.confirmLoading=!1,n&&n.data&&(this.$message.success("修改成功！"),this.confirmLoading=!1);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()})},Ze=Ge,Ke=Object(m["a"])(Ze,Fe,Ne,!1,null,null,null),Qe=Ke.exports;a["a"].use(h["a"]);var tn=h["a"].prototype.push;h["a"].prototype.push=function(t){return tn.call(this,t).catch((function(t){return t}))};var en=new h["a"]({routes:[{path:"/",component:nt,redirect:"/posts",children:[{path:"/posts",name:"posts",component:kt},{path:"/posts/edit",name:"postsEdit",component:Jt},{path:"/categories",name:"categories",component:pe},{path:"/ads",name:"ads",component:Le},{path:"/ads/edit/:id",name:"adsEdit",props:!0,component:Oe},{path:"/admin_users",name:"adminUsers",component:ze},{path:"/sites",name:"sites",component:Qe}]},{path:"/login",name:"login",component:lt},{path:"/403",component:function(){return n.e("chunk-2d0d2ec2").then(n.bind(null,"5b21"))}},{path:"/404",component:function(){return n.e("chunk-2d0d6ad4").then(n.bind(null,"7423"))}},{path:"*",name:"any",redirect:"/404"}]}),nn=en;a["a"].use(P["a"]);var an=new P["a"].Store({state:{currentCrumbs:[],currentUser:null},getters:{getCurrentCrumbs:function(t){return t.currentCrumbs},getCurrentUser:function(t){return t.currentUser}},mutations:{UPDATE_CURRENT_CRUMBS:function(t,e){t.currentCrumbs=e},UPDATE_CURRENT_USER:function(t,e){t.currentUser=e}},actions:{fetchCurrentUser:function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,t.next=3,a["a"].prototype.$http.get("rest/admin_users/current_user");case 3:return r=t.sent,r&&r.data&&n("UPDATE_CURRENT_USER",r.data),t.abrupt("return",r.data);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()}}),rn={appName:"express-antdesign-blog",defaultCategory:"catdefault",defaultAdmin:"admin"},sn=(n("f559"),rn.appName),on={get:function(t){t="".concat(sn,"-").concat(t);var e=localStorage.getItem(t);return e?JSON.parse(e):null},set:function(t,e){t="".concat(sn,"-").concat(t),localStorage.setItem(t,JSON.stringify(e))},remove:function(t){t="".concat(sn,"-").concat(t),localStorage.removeItem(t)},clear:function(){for(var t=localStorage.length,e=[],n=0;n<t;n++){var a=localStorage.key(n);a&&a.startsWith(sn)&&e.push(a)}e.map((function(t){return localStorage.removeItem(t)}))}},ln=on,cn=n("bc3a"),un=n.n(cn),dn=un.a.create({baseURL:Object({NODE_ENV:"production",VUE_APP_NAME:"express-antdesign-blog",BASE_URL:"/admin/"}).VUE_APP_API_URL||"/admin/api"});dn.interceptors.request.use((function(t){return a["a"].prototype.$storage.get("token")&&(t.headers.Authorization="Bearer ".concat(a["a"].prototype.$storage.get("token"))),t}),(function(t){return Promise.reject(t)})),dn.interceptors.response.use((function(t){return t}),(function(t){return t.response.data.massage&&a["a"].prototype.$message.error(t.response.data.massage),Promise.resolve(t)}));var mn=dn,pn={data:function(){return{}},computed:{},methods:{mixinUploadUrl:function(){return"".concat(this.$http.defaults.baseURL,"/upload")},mixinAuthHeaders:function(){return{Authorization:"Bearer ".concat(this.$storage.get("token"))}},mixinTableHeight:function(){var t=this;setTimeout((function(){t.setTableHeight(),window.addEventListener("resize",(function(){t.setTableHeight()}))}),50)},setTableHeight:function(){if(this.$refs.tableWrapper){var t=54,e=this.$refs.tableWrapper.clientHeight;this.tableScrollY=e-t,this.$forceUpdate()}}}},fn={},hn=n("323e"),gn=n.n(hn);n("a5d8");gn.a.configure({showSpinner:!1});var bn=["/login","/403","/404"];nn.beforeEach(function(){var t=Object(D["a"])(regeneratorRuntime.mark((function t(e,n,a){var r,i,s,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(gn.a.start(),r=ln.get("token"),i="/login",s="/login?redirect=".concat(e.path),!r){t.next=20;break}if(e.path!==i){t.next=9;break}a("/"),t.next=18;break;case 9:if(o=an.getters.getCurrentUser,!o){t.next=14;break}a(),t.next=18;break;case 14:return t.next=16,an.dispatch("fetchCurrentUser");case 16:l=t.sent,l?a():a(s);case 18:t.next=21;break;case 20:-1!==bn.indexOf(e.path)?a():a(s);case 21:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}()),nn.afterEach((function(){gn.a.done()}));var vn=n("f23d");n("0d6c"),n("0e79");a["a"].use(vn["a"]),a["a"].prototype.$config=rn,a["a"].prototype.$storage=ln,a["a"].prototype.$http=mn,a["a"].prototype.$utils=fn,a["a"].mixin(pn),new a["a"]({router:nn,store:an,render:function(t){return t(f)}}).$mount("#app")},"691d":function(t,e,n){"use strict";n.r(e),function(t){n("28a5"),n("5df3"),n("1c4c"),n("7f7f");var e=n("53ca");n("0d6d"),n("a481");(function(n){function a(t){var e=function(e,a,r,i){var s=new n.XMLHttpRequest;s.open("POST",t.url),s.withCredentials=t.credentials,s.upload.onprogress=function(t){i(t.loaded/t.total*100)},s.onerror=function(){r("Image upload failed due to a XHR Transport error. Code: "+s.status)},s.onload=function(){var e;if(200>s.status||300<=s.status)r("HTTP Error: "+s.status);else if((e=JSON.parse(s.responseText))&&"string"===typeof e.location){var n=t.basePath;e=e.location,n=n?n.replace(/\/$/,"")+"/"+e.replace(/^\//,""):e,a(n)}else r("Invalid JSON: "+s.responseText)};var o=new n.FormData;o.append("file",e.blob(),e.filename()),s.send(o)},a=function(t,e){return new W((function(n,a){try{e(t,n,a,i)}catch(r){a(r.message)}}))};return t=Ot.extend({credentials:!1,handler:e},t),{upload:function(n){return t.url||t.handler!==e?a(n,t.handler):W.reject("Upload url missing from the settings.")}}}var r=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){},s=function(t){return function(){return t}},o=function(t){return t},l=function(t){return function(){throw Error(t)}},c=s(!1),u=s(!0),d=function(){return m},m=function(){var t=function(t){return t.isNone()},e=function(t){return t()},n=function(t){return t};return t={fold:function(t,e){return t()},is:c,isSome:c,isNone:u,getOr:n,getOrThunk:e,getOrDie:function(t){throw Error(t||"error: getOrDie called on none.")},getOrNull:s(null),getOrUndefined:s(void 0),or:n,orThunk:e,map:d,each:i,bind:d,exists:c,forall:u,filter:d,equals:t,equals_:t,toArray:function(){return[]},toString:s("none()")},Object.freeze&&Object.freeze(t),t}(),p=function t(e){var n=s(e),a=function(){return i},r=function(t){return t(e)},i={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:u,isNone:c,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:a,orThunk:a,map:function(n){return t(n(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?i:m},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(c,(function(t){return n(e,t)}))}};return i},f={some:p,none:d,from:function(t){return null===t||void 0===t?m:p(t)}},h=function(t){return function(n){if(null===n)n="null";else{var a=Object(e["a"])(n);n="object"===a&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===a&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":a}return n===t}},g=h("string"),b=h("object"),v=h("array"),y=h("boolean"),w=h("function"),x=h("number"),_=Array.prototype.push,k=function(t){for(var e=[],n=0,a=t.length;n<a;++n){if(!v(t[n]))throw Error("Arr.flatten item "+n+" was not an array, input: "+t);_.apply(e,t[n])}return e},C=function(t){return 0===t.length?f.none():f.some(t[0])};w(Array.from);var j=function(t,e){for(var n=0;n<t.length;n++){var a=e(t[n],n);if(a.isSome())return a}return f.none()},I=function(){return I=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n],e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},I.apply(this,arguments)},O={},S={exports:O};(function(n,a,r,i){(function(i){"object"===Object(e["a"])(a)&&"undefined"!==typeof r?r.exports=i():"function"===typeof n&&n.amd?n([],i):("undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:this).EphoxContactWrapper=i()})((function(){return function(){function t(e,n,a){function r(o,l){if(!n[o]){if(!e[o]){var c="function"==typeof i&&i;if(!l&&c)return c(o,!0);if(s)return s(o,!0);throw l=Error("Cannot find module '"+o+"'"),l.code="MODULE_NOT_FOUND",l}l=n[o]={exports:{}},e[o][0].call(l.exports,(function(t){return r(e[o][1][t]||t)}),l,l.exports,t,e,n,a)}return n[o].exports}for(var s="function"==typeof i&&i,o=0;o<a.length;o++)r(a[o]);return r}return t}()({1:[function(t,e,n){function a(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function i(t){if(d===setTimeout)return setTimeout(t,0);if((d===a||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(n){return d.call(this,t,0)}}}function s(t){if(m===clearTimeout)return clearTimeout(t);if((m===r||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(t);try{return m(t)}catch(e){try{return m.call(null,t)}catch(n){return m.call(this,t)}}}function o(){h&&p&&(h=!1,p.length?f=p.concat(f):g=-1,f.length&&l())}function l(){if(!h){var t=i(o);h=!0;for(var e=f.length;e;){for(p=f,f=[];++g<e;)p&&p[g].run();g=-1,e=f.length}p=null,h=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}t=e.exports={};try{var d="function"===typeof setTimeout?setTimeout:a}catch(b){d=a}try{var m="function"===typeof clearTimeout?clearTimeout:r}catch(b){m=r}var p,f=[],h=!1,g=-1;t.nextTick=function(t){var e=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f.push(new c(t,e)),1!==f.length||h||i(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=u,t.addListener=u,t.once=u,t.off=u,t.removeListener=u,t.removeAllListeners=u,t.emit=u,t.prependListener=u,t.prependOnceListener=u,t.listeners=function(t){return[]},t.binding=function(t){throw Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(t){throw Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],2:[function(t,n,a){(function(t){(function(a){function r(){}function i(t,e){return function(){t.apply(e,arguments)}}function s(t){if("object"!==Object(e["a"])(this))throw new TypeError("Promises must be constructed via new");if("function"!==typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],m(t,this)}function o(t,e){for(;3===t._state;)t=t._value;0===t._state?t._deferreds.push(e):(t._handled=!0,s._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)(1===t._state?l:c)(e.promise,t._value);else{try{var a=n(t._value)}catch(r){return void c(e.promise,r)}l(e.promise,a)}})))}function l(t,n){try{if(n===t)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"===Object(e["a"])(n)||"function"===typeof n)){var a=n.then;if(n instanceof s)return t._state=3,t._value=n,void u(t);if("function"===typeof a)return void m(i(a,n),t)}t._state=1,t._value=n,u(t)}catch(r){c(t,r)}}function c(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&s._immediateFn((function(){t._handled||s._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)o(t,t._deferreds[e]);t._deferreds=null}function d(t,e,n){this.onFulfilled="function"===typeof t?t:null,this.onRejected="function"===typeof e?e:null,this.promise=n}function m(t,e){var n=!1;try{t((function(t){n||(n=!0,l(e,t))}),(function(t){n||(n=!0,c(e,t))}))}catch(a){n||(n=!0,c(e,a))}}var p=setTimeout;s.prototype["catch"]=function(t){return this.then(null,t)},s.prototype.then=function(t,e){var n=new this.constructor(r);return o(this,new d(t,e,n)),n},s.all=function(t){var n=Array.prototype.slice.call(t);return new s((function(t,a){function r(s,o){try{if(o&&("object"===Object(e["a"])(o)||"function"===typeof o)){var l=o.then;if("function"===typeof l)return void l.call(o,(function(t){r(s,t)}),a)}n[s]=o,0===--i&&t(n)}catch(c){a(c)}}if(0===n.length)return t([]);for(var i=n.length,s=0;s<n.length;s++)r(s,n[s])}))},s.resolve=function(t){return t&&"object"===Object(e["a"])(t)&&t.constructor===s?t:new s((function(e){e(t)}))},s.reject=function(t){return new s((function(e,n){n(t)}))},s.race=function(t){return new s((function(e,n){for(var a=0,r=t.length;a<r;a++)t[a].then(e,n)}))},s._immediateFn="function"===typeof t?function(e){t(e)}:function(t){p(t,0)},s._unhandledRejectionFn=function(t){"undefined"!==typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},s._setImmediateFn=function(t){s._immediateFn=t},s._setUnhandledRejectionFn=function(t){s._unhandledRejectionFn=t},"undefined"!==typeof n&&n.exports?n.exports=s:a.Promise||(a.Promise=s)})(this)}).call(this,t("timers").setImmediate)},{timers:3}],3:[function(t,e,n){(function(e,a){function r(t,e){this._id=t,this._clearFn=e}var i=t("process/browser.js").nextTick,s=Function.prototype.apply,o=Array.prototype.slice,l={},c=0;n.setTimeout=function(){return new r(s.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new r(s.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n.setImmediate="function"===typeof e?e:function(t){var e=c++,a=!(2>arguments.length)&&o.call(arguments,1);return l[e]=!0,i((function(){l[e]&&(a?t.apply(null,a):t.call(null),n.clearImmediate(e))})),e},n.clearImmediate="function"===typeof a?a:function(t){delete l[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(t,e,n){t=t("promise-polyfill"),n="undefined"!==typeof window?window:Function("return this;")(),e.exports={boltExport:n.Promise||t}},{"promise-polyfill":2}]},{},[4])(4)}))})(void 0,O,S,void 0);var D=S.exports.boltExport,P=function t(e){var a=f.none(),r=[],i=function(t){s()?o(t):r.push(t)},s=function(){return a.isSome()},o=function(t){a.each((function(e){n.setTimeout((function(){t(e)}),0)}))};return e((function(t){a=f.some(t),t=r;for(var e=o,n=0,i=t.length;n<i;n++)e(t[n],n);r=[]})),{get:i,map:function(e){return t((function(t){i((function(n){t(e(n))}))}))},isReady:s}},$={nu:P,pure:function(t){return P((function(e){e(t)}))}},L=function(t){n.setTimeout((function(){throw t}),0)},U=function t(e){var n=function(t){e().then(t,L)};return{map:function(n){return t((function(){return e().then(n)}))},bind:function(n){return t((function(){return e().then((function(t){return n(t).toPromise()}))}))},anonBind:function(n){return t((function(){return e().then((function(){return n.toPromise()}))}))},toLazy:function(){return $.nu(n)},toCached:function(){var n=null;return t((function(){return null===n&&(n=e()),n}))},toPromise:e,get:n}},R={nu:function(t){return U((function(){return new D(t)}))},pure:function(t){return U((function(){return D.resolve(t)}))}},V=function t(e){return{is:function(t){return e===t},isValue:u,isError:c,getOr:s(e),getOrThunk:s(e),getOrDie:s(e),or:function(n){return t(e)},orThunk:function(n){return t(e)},fold:function(t,n){return n(e)},map:function(n){return t(n(e))},mapError:function(n){return t(e)},each:function(t){t(e)},bind:function(t){return t(e)},exists:function(t){return t(e)},forall:function(t){return t(e)},toOption:function(){return f.some(e)}}},T=function t(e){return{is:c,isValue:c,isError:u,getOr:o,getOrThunk:function(t){return t()},getOrDie:function(){return l(String(e))()},or:function(t){return t},orThunk:function(t){return t()},fold:function(t,n){return t(e)},map:function(n){return t(e)},mapError:function(n){return t(n(e))},each:i,bind:function(n){return t(e)},exists:c,forall:u,toOption:f.none}},E={value:V,error:T,fromOption:function(t,e){return t.fold((function(){return T(e)}),V)}},A=function t(e){return I(I({},e),{toCached:function(){return t(e.toCached())},bindFuture:function(n){return t(e.bind((function(t){return t.fold((function(t){return R.pure(E.error(t))}),(function(t){return n(t)}))})))},bindResult:function(n){return t(e.map((function(t){return t.bind(n)})))},mapResult:function(n){return t(e.map((function(t){return t.map(n)})))},mapError:function(n){return t(e.map((function(t){return t.mapError(n)})))},foldResult:function(t,n){return e.map((function(e){return e.fold(t,n)}))},withTimeout:function(a,r){return t(R.nu((function(t){var i=!1,s=n.setTimeout((function(){i=!0,t(E.error(r()))}),a);e.get((function(e){i||(n.clearTimeout(s),t(e))}))})))}})},z=function(t){return A(R.nu(t))},F=function(t){return A(R.pure(E.value(t)))},N={nu:z,wrap:A,pure:F,value:F,error:function(t){return A(R.pure(E.error(t)))},fromResult:function(t){return A(R.pure(t))},fromFuture:function(t){return A(t.map(E.value))},fromPromise:function(t){return z((function(e){t.then((function(t){e(E.value(t))}),(function(t){e(E.error(t))}))}))}},M=Object.prototype.hasOwnProperty,B=function(t){return function(){for(var e=Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];if(0===e.length)throw Error("Can't merge zero objects");n={};for(var a=0;a<e.length;a++){var r,i=e[a];for(r in i)M.call(i,r)&&(n[r]=t(n[r],i[r]))}return n}}((function(t,e){return b(t)&&b(e)?B(t,e):e}));"undefined"!==typeof n.window||Function("return this;")();var H=function(t,e,a){if(!(g(a)||y(a)||x(a)))throw n.console.error("Invalid call to Attr.set. Key ",e,":: Value ",a,":: Element ",t),Error("Attribute value was not simple");t.setAttribute(e,a+"")},Y=function(t){if(null===t||void 0===t)throw Error("Node cannot be null or undefined");return{dom:s(t)}},q={fromHtml:function(t,e){if(e=(e||n.document).createElement("div"),e.innerHTML=t,!e.hasChildNodes()||1<e.childNodes.length)throw n.console.error("HTML does not have a single root node",t),Error("HTML must have a single root node");return Y(e.childNodes[0])},fromTag:function(t,e){return t=(e||n.document).createElement(t),Y(t)},fromText:function(t,e){return t=(e||n.document).createTextNode(t),Y(t)},fromDom:Y,fromPoint:function(t,e,n){return t=t.dom(),f.from(t.elementFromPoint(e,n)).map(Y)}},J=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),W=tinymce.util.Tools.resolve("tinymce.util.Promise"),X=tinymce.util.Tools.resolve("tinymce.util.XHR"),G=function(t){return t.getParam("images_upload_url","","string")},Z=function(t){return t.getParam("images_upload_handler",void 0,"function")},K={hasDimensions:function(t){return t.getParam("image_dimensions",!0,"boolean")},hasUploadTab:function(t){return t.getParam("image_uploadtab",!0,"boolean")},hasAdvTab:function(t){return t.getParam("image_advtab",!1,"boolean")},getPrependUrl:function(t){return t.getParam("image_prepend_url","","string")},getClassList:function(t){return t.getParam("image_class_list")},hasDescription:function(t){return t.getParam("image_description",!0,"boolean")},hasImageTitle:function(t){return t.getParam("image_title",!1,"boolean")},hasImageCaption:function(t){return t.getParam("image_caption",!1,"boolean")},getImageList:function(t){return t.getParam("image_list",!1)},hasUploadUrl:function(t){return!!G(t)},hasUploadHandler:function(t){return!!Z(t)},getUploadUrl:G,getUploadHandler:Z,getUploadBasePath:function(t){return t.getParam("images_upload_base_path",void 0,"string")},getUploadCredentials:function(t){return t.getParam("images_upload_credentials",!1,"boolean")},showAccessibilityOptions:function(t){return t.getParam("a11y_advanced_options",!1,"boolean")},isAutomaticUploadsEnabled:function(t){return t.getParam("automatic_uploads",!0,"boolean")}},Q=function(t,e){return Math.max(parseInt(t,10),parseInt(e,10))},tt={getImageSize:function(t,e){var a=n.document.createElement("img");a.onload=function(){var t=Q(a.width,a.clientWidth),n=Q(a.height,a.clientHeight);t=E.value({width:t,height:n}),a.parentNode&&a.parentNode.removeChild(a),e(t)},a.onerror=function(){var n=E.error("Failed to get image dimensions for: "+t);a.parentNode&&a.parentNode.removeChild(a),e(n)};var r=a.style;r.visibility="hidden",r.position="fixed",r.bottom=r.left="0px",r.width=r.height="auto",n.document.body.appendChild(a),a.src=t},removePixelSuffix:function(t){return t&&(t=t.replace(/px$/,"")),t},addPixelSuffix:function(t){return 0<t.length&&/^[0-9]+$/.test(t)&&(t+="px"),t},mergeMargins:function(t){if(t.margin){var e=String(t.margin).split(" ");switch(e.length){case 1:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[0],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[0];break;case 2:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[1];break;case 3:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[1];break;case 4:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[3]}delete t.margin}return t},createImageList:function(t,e){t=K.getImageList(t),"string"===typeof t?X.send({url:t,success:function(t){e(JSON.parse(t))}}):"function"===typeof t?t(e):e(t)},waitLoadImage:function(t,e,n){var a=function(){n.onload=n.onerror=null,t.selection&&(t.selection.select(n),t.nodeChanged())};n.onload=function(){e.width||e.height||!K.hasDimensions(t)||t.dom.setAttribs(n,{width:String(n.clientWidth),height:String(n.clientHeight)}),a()},n.onerror=a},blobToDataUri:function(t){return new W((function(e,a){var r=new n.FileReader;r.onload=function(){e(r.result)},r.onerror=function(){a(r.error.message)},r.readAsDataURL(t)}))},isPlaceholderImage:function(t){return"IMG"===t.nodeName&&(t.hasAttribute("data-mce-object")||t.hasAttribute("data-mce-placeholder"))}},et=J.DOM,nt=function(t){return t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?tt.removePixelSuffix(t.style.marginLeft):""},at=function(t){return t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?tt.removePixelSuffix(t.style.marginTop):""},rt=function(t,e){return t.hasAttribute(e)?t.getAttribute(e):""},it=function(t,e){return t.style[e]?t.style[e]:""},st=function(t,e,n){t.setAttribute(e,n)},ot=function(t,e){var n=t.getAttribute("style");e=e(null!==n?n:""),0<e.length?(t.setAttribute("style",e),t.setAttribute("data-mce-style",e)):t.removeAttribute("style")},lt=function(t,e){return function(t,n,a){t.style[n]?(t.style[n]=tt.addPixelSuffix(a),ot(t,e)):t.setAttribute(n,a)}},ct=function(t,e){return t.style[e]?tt.removePixelSuffix(t.style[e]):rt(t,e)},ut=function(t,e){e=tt.addPixelSuffix(e),t.style.marginLeft=e,t.style.marginRight=e},dt=function(t,e){e=tt.addPixelSuffix(e),t.style.marginTop=e,t.style.marginBottom=e},mt=function(t,e){e=tt.addPixelSuffix(e),t.style.borderWidth=e},pt=function(t,e){t.style.borderStyle=e},ft=function(t){return 0===et.getAttrib(t,"alt").length&&"presentation"===et.getAttrib(t,"role")},ht=function(t,e,a){var r=n.document.createElement("img");return wt(t,I(I({},e),{caption:!1}),r,a),vt(r,e.alt,e.isDecorative,a),e.caption?(t=et.create("figure",{class:"image"}),t.appendChild(r),t.appendChild(et.create("figcaption",{contentEditable:"true"},"Caption")),t.contentEditable="false",t):r},gt=function(t,e){var n=rt(e,"src"),a=ft(e)?"":rt(e,"alt");return{src:n,alt:a,title:rt(e,"title"),width:ct(e,"width"),height:ct(e,"height"),class:rt(e,"class"),style:t(rt(e,"style")),caption:null!==e.parentNode&&"FIGURE"===e.parentNode.nodeName,hspace:nt(e),vspace:at(e),border:e.style.borderWidth?tt.removePixelSuffix(e.style.borderWidth):"",borderStyle:it(e,"borderStyle"),isDecorative:ft(e)}},bt=function(t,e,n,a,r){n[a]!==e[a]&&r(t,a,n[a])},vt=function(t,e,n,a){n?(et.setAttrib(t,"role","presentation"),n=q.fromDom(t),H(n.dom(),"alt","")):(a.hasAccessibilityOptions?et.setAttrib(t,"alt",e):(n=q.fromDom(t),H(n.dom(),"alt",e)),"presentation"===et.getAttrib(t,"role")&&et.setAttrib(t,"role",""))},yt=function(t,e){return function(n,a,r){t(n,r),ot(n,e)}},wt=function(t,e,n,a){var r=gt(t,n);bt(n,r,e,"caption",(function(t,e,n){null!==t.parentNode&&"FIGURE"===t.parentNode.nodeName?(e=t.parentNode,et.insertAfter(t,e),et.remove(e)):(e=et.create("figure",{class:"image"}),et.insertAfter(e,t),e.appendChild(t),e.appendChild(et.create("figcaption",{contentEditable:"true"},"Caption")),e.contentEditable="false")})),bt(n,r,e,"src",st),bt(n,r,e,"title",st),bt(n,r,e,"width",lt("width",t)),bt(n,r,e,"height",lt("height",t)),bt(n,r,e,"class",st),bt(n,r,e,"style",yt((function(t,e){t.setAttribute("style",e)}),t)),bt(n,r,e,"hspace",yt(ut,t)),bt(n,r,e,"vspace",yt(dt,t)),bt(n,r,e,"border",yt(mt,t)),bt(n,r,e,"borderStyle",yt(pt,t)),e.alt===r.alt&&e.isDecorative===r.isDecorative||vt(n,e.alt,e.isDecorative,a)},xt=function(t,e){return e=t.dom.styles.parse(e),e=tt.mergeMargins(e),e=t.dom.styles.parse(t.dom.styles.serialize(e)),t.dom.styles.serialize(e)},_t=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return n?t.dom.select("img",n)[0]:e&&("IMG"!==e.nodeName||tt.isPlaceholderImage(e))?null:e},kt=function(t,e){var n=t.dom,a=n.getParent(e.parentNode,(function(e){return!!t.schema.getTextBlockElements()[e.nodeName]}),t.getBody());return a?n.split(a,e):e},Ct=function(t){var e=_t(t);return e?gt((function(e){return xt(t,e)}),e):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1}},jt=function(t,e,n){e=ht((function(e){return xt(t,e)}),e,n),t.dom.setAttrib(e,"data-mce-id","__mcenew"),t.focus(),t.selection.setContent(e.outerHTML),e=t.dom.select('*[data-mce-id="__mcenew"]')[0],t.dom.setAttrib(e,"data-mce-id",null),"FIGURE"===e.nodeName?(e=kt(t,e),t.selection.select(e)):t.selection.select(e)},It=function(t,e,n){var a=_t(t);wt((function(e){return xt(t,e)}),e,a,n),t.dom.setAttrib(a,"src",a.getAttribute("src")),"FIGURE"===a.parentNode.nodeName?(kt(t,a.parentNode),t.selection.select(a.parentNode)):(t.selection.select(a),tt.waitLoadImage(t,e,a))},Ot=tinymce.util.Tools.resolve("tinymce.util.Tools"),St=function(t){return g(t.value)?t.value:""},Dt=function t(e,n){var a=[];return Ot.each(e,(function(e){var r=g(e.text)?e.text:g(e.title)?e.title:"";void 0!==e.menu?(e=t(e.menu,n),a.push({text:r,items:e})):(e=n(e),a.push({text:r,value:e}))})),a},Pt=function(t){return void 0===t&&(t=St),function(e){return e?f.from(e).map((function(e){return Dt(e,t)})):f.none()}},$t=function t(e,n){return j(e,(function(e){return Object.prototype.hasOwnProperty.call(e,"items")?t(e.items,n):e.value===n?f.some(e):f.none()}))},Lt={sanitizer:Pt,sanitize:function(t){return Pt(St)(t)},findEntry:function(t,e){return t.bind((function(t){return $t(t,e)}))}},Ut={makeTab:function(t){return{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"selectbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}}},Rt=function(t){var e=Lt.sanitizer((function(e){return t.convertURL(e.value||e.url,"src")})),n=R.nu((function(n){tt.createImageList(t,(function(t){n(e(t).map((function(t){return k([[{text:"None",value:""}],t])})))}))})),a=Lt.sanitize(K.getClassList(t)),r=K.hasAdvTab(t),i=K.hasUploadTab(t),s=K.hasUploadUrl(t),o=K.hasUploadHandler(t),l=Ct(t),c=K.hasDescription(t),u=K.hasImageTitle(t),d=K.hasDimensions(t),m=K.hasImageCaption(t),p=K.showAccessibilityOptions(t),h=K.getUploadUrl(t),b=K.getUploadBasePath(t),v=K.getUploadCredentials(t),y=K.getUploadHandler(t),w=K.isAutomaticUploadsEnabled(t),x=f.some(K.getPrependUrl(t)).filter((function(t){return g(t)&&0<t.length}));return n.map((function(t){return{image:l,imageList:t,classList:a,hasAdvTab:r,hasUploadTab:i,hasUploadUrl:s,hasUploadHandler:o,hasDescription:c,hasImageTitle:u,hasDimensions:d,hasImageCaption:m,url:h,basePath:b,credentials:v,handler:y,prependURL:x,hasAccessibilityOptions:p,automaticUploads:w}}))},Vt=function(t){var e=t.imageList.map((function(t){return{name:"images",type:"selectbox",label:"Image list",items:t}})),n={name:"alt",type:"input",label:"Alternative description",disabled:t.hasAccessibilityOptions&&t.image.isDecorative},a={name:"title",type:"input",label:"Image title"},r={name:"dimensions",type:"sizeinput"},i={type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]},s=t.classList.map((function(t){return{name:"classes",type:"selectbox",label:"Class",items:t}})),o={type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]};return k([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],e.toArray(),t.hasAccessibilityOptions&&t.hasDescription?[i]:[],t.hasDescription?[n]:[],t.hasImageTitle?[a]:[],t.hasDimensions?[r]:[],[{type:"grid",columns:2,items:k([s.toArray(),t.hasImageCaption?[o]:[]])}]])},Tt={makeTab:function(t){return{title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]}},makeItems:Vt},Et={makeTab:function(t){return{title:"General",name:"general",items:Vt(t)}}},At=function(t){return{src:{value:t.src,meta:{}},images:t.src,alt:t.alt,title:t.title,dimensions:{width:t.width,height:t.height},classes:t.class,caption:t.caption,style:t.style,vspace:t.vspace,border:t.border,hspace:t.hspace,borderstyle:t.borderStyle,fileinput:[],isDecorative:t.isDecorative}},zt=function(t){return{src:t.src.value,alt:t.alt,title:t.title,width:t.dimensions.width,height:t.dimensions.height,class:t.classes,style:t.style,caption:t.caption,hspace:t.hspace,vspace:t.vspace,border:t.border,borderStyle:t.borderstyle,isDecorative:t.isDecorative}},Ft=function(t,e){return/^(?:[a-zA-Z]+:)?\/\//.test(e)?f.none():t.prependURL.bind((function(t){return e.substring(0,t.length)!==t?f.some(t+e):f.none()}))},Nt=function(t,e){var n=e.getData();Ft(t,n.src.value).each((function(t){e.setData({src:{value:t,meta:n.src.meta}})}))},Mt=function(t,e,n){t.hasDescription&&g(n.alt)&&(e.alt=n.alt),t.hasAccessibilityOptions&&(e.isDecorative=n.isDecorative||!1),t.hasImageTitle&&g(n.title)&&(e.title=n.title),t.hasDimensions&&(g(n.width)&&(e.dimensions.width=n.width),g(n.height)&&(e.dimensions.height=n.height)),g(n.class)&&Lt.findEntry(t.classList,n.class).each((function(t){e.classes=t.value})),t.hasImageCaption&&y(n.caption)&&(e.caption=n.caption),t.hasAdvTab&&(g(n.style)&&(e.style=n.style),g(n.vspace)&&(e.vspace=n.vspace),g(n.border)&&(e.border=n.border),g(n.hspace)&&(e.hspace=n.hspace),g(n.borderstyle)&&(e.borderstyle=n.borderstyle))},Bt=function(t,e,n,a){var r=a.getData(),i=r.src.value;r=r.src.meta||{},r.width||r.height||!e.hasDimensions||t.imageSize(i).get((function(t){t.each((function(t){n.open&&a.setData({dimensions:t})}))}))},Ht=function(t,e,n){var a=n.getData();t=Lt.findEntry(t.imageList,a.src.value),e.prevImage=t,n.setData({images:t.map((function(t){return t.value})).getOr("")})},Yt=function(t,e,n,a){Nt(e,a);var r=a.getData(),i=r.src.meta;void 0!==i&&(r=B({},r),Mt(e,r,i),a.setData(r)),Bt(t,e,n,a),Ht(e,n,a)},qt=function(t,e,n,a){var r=a.getData(),i=Lt.findEntry(e.imageList,r.images);i.each((function(t){""===r.alt||n.prevImage.map((function(t){return t.text===r.alt})).getOr(!1)?""===t.value?a.setData({src:t,alt:n.prevAlt}):a.setData({src:t,alt:t.text}):a.setData({src:t})})),n.prevImage=i,Yt(t,e,n,a)},Jt=function(t,e,r,i){var s=i.getData();i.block("Uploading image"),C(s.fileinput).fold((function(){i.unblock()}),(function(s){var o=n.URL.createObjectURL(s),l=a({url:e.url,basePath:e.basePath,credentials:e.credentials,handler:e.handler}),c=function(n){i.setData({src:{value:n,meta:{}}}),i.showTab("general"),Yt(t,e,r,i)};tt.blobToDataUri(s).then((function(a){a=t.createBlobCache(s,o,a),e.automaticUploads?l.upload(a).then((function(t){c(t),i.unblock(),n.URL.revokeObjectURL(o)})).catch((function(e){i.unblock(),n.URL.revokeObjectURL(o),t.alertErr(i,e)})):(t.addToBlobCache(a),c(a.blobUri()),i.unblock())}))}))},Wt=function(t,e,a){return function(r,i){if("src"===i.name)Yt(t,e,a,r);else if("images"===i.name)qt(t,e,a,r);else if("alt"===i.name)a.prevAlt=r.getData().alt;else if("style"===i.name){var s=r.getData();i=t.parseStyle;var o=t.serializeStyle,l=tt.mergeMargins(i(s.style));s=B({},s),s.vspace=l["margin-top"]&&l["margin-bottom"]&&l["margin-top"]===l["margin-bottom"]?tt.removePixelSuffix(String(l["margin-top"])):"",s.hspace=l["margin-right"]&&l["margin-left"]&&l["margin-right"]===l["margin-left"]?tt.removePixelSuffix(String(l["margin-right"])):"",s.border=l["border-width"]?tt.removePixelSuffix(String(l["border-width"])):"",s.borderstyle=l["border-style"]?String(l["border-style"]):"",s.style=o(i(o(l))),r.setData(s)}else"vspace"===i.name||"hspace"===i.name||"border"===i.name||"borderstyle"===i.name?(o=B(At(e.image),r.getData()),i=t.normalizeCss,o=zt(o),l=n.document.createElement("img"),l.setAttribute("style",o.style),(nt(l)||""!==o.hspace)&&ut(l,o.hspace),(at(l)||""!==o.vspace)&&dt(l,o.vspace),(l.style.borderWidth&&tt.removePixelSuffix(l.style.borderWidth)||""!==o.border)&&mt(l,o.border),(it(l,"borderStyle")||""!==o.borderStyle)&&pt(l,o.borderStyle),i=i(l.getAttribute("style")),r.setData({style:i})):"fileinput"===i.name?Jt(t,e,a,r):"isDecorative"===i.name&&(r.getData().isDecorative?r.disable("alt"):r.enable("alt"))}},Xt=function(t){return function(){t.open=!1}},Gt=function(t){return function(e){var n={prevImage:Lt.findEntry(e.imageList,e.image.src),prevAlt:e.image.alt,open:!0},a=e.hasAdvTab||e.hasUploadUrl||e.hasUploadHandler?{type:"tabpanel",tabs:k([[Tt.makeTab(e)],e.hasAdvTab?[Ut.makeTab(e)]:[],e.hasUploadTab&&(e.hasUploadUrl||e.hasUploadHandler)?[Et.makeTab(e)]:[]])}:{type:"panel",items:Tt.makeItems(e)};return{title:"Insert/Edit Image",size:"normal",body:a,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:At(e.image),onSubmit:t.onSubmit(e),onChange:Wt(t,e,n),onClose:Xt(n)}}},Zt=function(t){return function(e){return function(n){var a=B(At(e.image),n.getData());t.undoManager.transact((function(){var n=zt(a),r=_t(t);r?n.src?It(t,n,e):r&&(n=t.dom.is(r.parentNode,"figure.image")?r.parentNode:r,t.dom.remove(n),t.focus(),t.nodeChanged(),t.dom.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())):n.src&&jt(t,n,e)})),t.editorUpload.uploadImagesAuto(),n.close()}}},Kt=function(t){return function(e){return N.nu((function(n){tt.getImageSize(t.documentBaseURI.toAbsolute(e),(function(t){t=t.map((function(t){return{width:String(t.width),height:String(t.height)}})),n(t)}))}))}},Qt=function(t){return function(e,n,a){return t.editorUpload.blobCache.create({blob:e,blobUri:n,name:e.name?e.name.replace(/\.[^\.]+$/,""):null,base64:a.split(",")[1]})}},te=function(t){return function(e){t.editorUpload.blobCache.add(e)}},ee=function(t){return function(e,n){t.windowManager.alert(n,e.close)}},ne=function(t){return function(e){return xt(t,e)}},ae=function(t){return function(e){return t.dom.parseStyle(e)}},re=function(t){return function(e,n){return t.dom.serializeStyle(e,n)}},ie=function(t){var e={onSubmit:Zt(t),imageSize:Kt(t),addToBlobCache:te(t),createBlobCache:Qt(t),alertErr:ee(t),normalizeCss:ne(t),parseStyle:ae(t),serializeStyle:re(t)};return{open:function(){return Rt(t).map(Gt(e)).get((function(e){t.windowManager.open(e)}))}}},se={register:function(t){t.addCommand("mceImage",ie(t).open)}},oe=function(t){return(t=t.attr("class"))&&/\bimage\b/.test(t)},le=function(t){return function(e){for(var n=e.length,a=function(e){e.attr("contenteditable",t?"true":null)};n--;){var r=e[n];oe(r)&&(r.attr("contenteditable",t?"false":null),Ot.each(r.getAll("figcaption"),a))}}},ce={setup:function(t){t.on("PreInit",(function(){t.parser.addNodeFilter("figure",le(!0)),t.serializer.addNodeFilter("figure",le(!1))}))}},ue={register:function(t){t.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:ie(t).open,onSetup:function(e){return t.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",e.setActive).unbind}}),t.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:ie(t).open}),t.ui.registry.addContextMenu("image",{update:function(t){return"FIGURE"===t.nodeName||"IMG"===t.nodeName&&!tt.isPlaceholderImage(t)?["image"]:[]}})}};(function(){r.add("image",(function(t){ce.setup(t),ue.register(t),se.register(t)}))})()})(window)}.call(this,n("c8ba"))},a892:function(t,e,n){n("691d")},f6cf:function(t,e,n){n("0597")}});
//# sourceMappingURL=app.a3c55773.js.map